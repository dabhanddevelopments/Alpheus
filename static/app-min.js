Ext.Loader.setPath("Ext.ux","http://dabhand.net:8000/static/ext-4.2.1/examples/ux");Ext.require(["Ext.ux.RowExpander"]);Ext.require(["Ext.container.Viewport","Ext.layout.container.Border","Ext.tab.Panel","Ext.tree.*","Ext.data.*","Ext.menu.*","Ext.window.MessageBox","Ext.grid.*",]);function displayInnerGrid(f,e,g,d,a){fields=[];for(i=0;i<e.columns.length;i++){fields[i]=e.columns[i].dataIndex}if(typeof d=="undefined"){d:false}if(typeof a=="undefined"){a:100}var h=Ext.create("Ext.data.Store",{fields:fields,data:e.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var b=Ext.create("Ext.grid.Panel",{store:h,selModel:{selType:"cellmodel"},columns:e.columns,header:false,autoFit:true,width:1000,height:a,iconCls:"icon-grid",hideHeaders:d,renderTo:"innergrid-"+f.id+"-"+g,});b.getEl().swallowEvent(["mousedown","mouseup","click","contextmenu","mouseover","mouseout","dblclick","mousemove"])}function zoomGraph(k,h){var m=h.qs.replace("&value_date__month=2,4,6,8,10,12","");var b=new Date(k.min);var g=new Date(k.max);var j=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var f="&value_date__gte="+j+"&value_date__lte="+d;range=(k.max/1000)-(k.min/1000);range=Math.round(range);var a="";if(range>300000000){a="&value_date__month=2,4,6,8,10,12"}else{if(range>=240000000){}else{if(range>=120000000){}else{if(range>=60000000){}else{var a=""}}}}var l=$("#"+h.div).highcharts();l.showLoading("Loading data from server...");$.getJSON(h.url+m+f+a,function(e){l.series[0].setData(e[0].data);l.hideLoading()})}function zoomLineBarGraph(k){console.log(k);holding=$("#data").data("holding");var a=$("#data").data("linebar-div");var m="?holding_category__holding_group__isnull=true&holding="+holding;var d=new Date(k.min);var h=new Date(k.max);var j=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();var f=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var g="&value_date__gte="+j+"&value_date__lte="+f;range=(k.max/1000)-(k.min/1000);range=Math.round(range);if(range>31557600){var b="&value_date__month=2,4,6,8,10,12&value_date__day=1"}else{if(range>=31535000){var b="&value_date__week_day=4"}else{if(range>=15535000){var b="&value_date__week_day=3,5"}else{if(range>=7700000){var b="&value_date__week_day=2,4,6"}else{var b=""}}}}var l=$("#"+a).highcharts();l.showLoading("Loading data from server...");$.getJSON("/api/widget/fundperfholdpriceline/"+m+g+b,function(e){l.series[0].setData(e);l.hideLoading();$.getJSON("/api/widget/fundperfholdvolbar/"+m+g+b,function(n){l.series[1].setData(n);l.hideLoading()})})}function lineBarChart(b){b.url="/api/widget/fundperfholdpriceline/";b.qs="?holding_category__holding_group__isnull=true&value_date__month=2,4,6,8,10,12&value_date__day=1&holding__fund="+b.fund+"&holding="+b.holding;$("#data").data("holding",b.holding);var d=$("#data").data("linebar-div");var a=$("#"+d).highcharts();if(typeof a!="undefined"){a.destroy()}$.getJSON(b.url+b.qs,function(e){b.url="/api/widget/fundperfholdvolbar/";$.getJSON(b.url+b.qs,function(h){var f={chart:{renderTo:d,marginTop:5,marginBottom:50,marginRight:50,spacingBottom:50,spacingRight:50,},navigator:{enabled:true,adaptToUpdatedData:false,series:{data:e}},scrollbar:{enabled:false,},title:{text:false,},xAxis:[{gridLineWidth:1,type:"datetime",labels:{rotation:-45,align:"right",style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}},events:{afterSetExtremes:zoomLineBarGraph},minRange:3600*1000},{}],yAxis:[{height:180,lineWidth:3,offset:0,gridLineWidth:1,title:{text:"Price",margin:5,}},{top:225,lineWidth:3,gridLineWidth:1,offset:0,height:75,title:{text:"Volume",}},],legend:{enabled:true,verticalAlign:"top",y:-10,},rangeSelector:{enabled:true,buttons:[{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],inputEnabled:false,selected:4},series:[{yAxis:0,name:"Price by time",stack:0,data:e,tooltip:{valueDecimals:2},},{name:"Volume",yAxis:1,stack:0,data:h,tooltip:{valueDecimals:2},lineWidth:3,marker:{enabled:false},pointWidth:5,type:"column",},]};var g=new Highcharts.Chart(f)})})}function destroyInnerGrid(a,b){var d=document.getElementById("innergrid-"+b+"-"+a.get("id"));var e=d.firstChild;while(e){e.parentNode.removeChild(e);e=e.nextSibling}}function refreshHoldPerfBar(f,e,d,j,h){if(typeof j=="undefined"){j="nav"}if(typeof h=="undefined"){h="weight"}var b=$("#data").data("div-fundperfholdperfbar");var m=f;if(typeof d!="undefined"&&d==true){m=moment(f).format("MMM YYYY")}var l=$("#data").data("fund_name")+" / "+m+" / Holding Performance Bar Graph";var k=$("#"+b).highcharts();var a="/api/widget/fundperfholdperfbar/?value_date="+f+"&fund="+e+"&legend=false&fields="+j+"&order_by="+h+"&holding_category__isnull=true";try{k.destroy();$.getJSON(a,function(o){widget={};widget.size_x=7;widget.size_y=3;var n=new Highcharts.Chart({chart:{renderTo:b,type:"column",width:(120*widget.size_x)+(10*widget.size_x)+(10*(widget.size_x-1))-30,height:(120*widget.size_y)+(10*widget.size_y)+(10*(widget.size_y-1))-35,},title:{text:false,},legend:{enabled:false,},xAxis:{type:"category",categories:o.columns,labels:{rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"},enabled:labels,},},series:o.objects,})})}catch(g){}}Ext.onReady(function(){function v(){graphs={1:[{ann_return1:"Returns one ann"},{ann_volatility1:"Volatility one ann"},{alpha1:"Alpha one ann"},{beta1:"Beta one ann"},{sharpe_ratio1:"Sharpe one ann"},{correlation1:"Correlation one ann"},],2:[{ann_return3:"Returns three ann"},{ann_volatility3:"Volatility three ann"},{alpha3:"Alpha three ann"},{beta3:"Beta three ann"},{sharpe_ratio3:"Sharpe three ann"},{correlation3:"Correlation three ann"},],3:[{ann_return5:"Returns five ann"},{ann_volatility5:"Volatility five ann"},{alpha5:"Alpha five ann"},{beta5:"Beta five ann"},{sharpe_ratio5:"Sharpe five ann"},{correlation5:"Correlation five ann"},]};var R=$("#data").data("fund");items=[];for(var U in graphs){children=[];for(var Q in graphs[U]){key=Object.keys(graphs[U][Q])[0];var T="summary2-bar-"+key;var S="summary2-line-"+key;$('<div id="'+T+'"></div>').appendTo("body");$('<div id="'+S+'"></div>').appendTo("body");win_widget={};win_widget.url="/api/widget/fundperfmonthmin/";win_widget.qs="?fund="+R+"&fields="+key+"&value_date__month=2,4,6,8,10,12";win_widget.size_y=1.9;win_widget.size_x=3;win_widget.div=T;win_widget.params={};win_widget.params.type="column";win_widget.params.legend="false";win_widget.params.scrollbar="false";win_widget.params.navigator="true";win_widget.params.zoom="true";win_widget.params.rangeSelector="true";win_widget.params.title="false";win_widget.params.yAxisTitle=graphs[U][Q][key];win_widget.params.date_type="month";l("",win_widget,T);children.push({xtype:"tabpanel",border:1,width:(120*win_widget.size_x)+(10*win_widget.size_x)+(10*(win_widget.size_x-1))-20,height:(120*win_widget.size_y)+(10*win_widget.size_y)+(10*(win_widget.size_y-1))+20,items:[{xtype:"panel",title:"Bar",contentEl:T,id:T},{xtype:"panel",title:"Line",contentEl:S,id:S}],listeners:{tabchange:function(W,V){win_widget.params.type="line";l("",win_widget,V.id)}}})}parent={xtype:"container",layout:"hbox",items:children,};items.push(parent)}Ext.onReady(function(){var V=new Ext.Window({renderTo:Ext.getBody(),items:items,listeners:{close:function(X,W){$.each(graphs,function(Y,Z){$.each(Z,function(aa,ab){aa=Object.keys(ab)[0];F("summary2-bar-"+aa);F("summary2-line-"+aa)})})}}});V.toggleMaximize();V.show()})}function F(R){if(typeof $("#"+R).highcharts()!="undefined"){var Q=$("#"+R).highcharts();Q.destroy()}}$('<div id="data"></div>').appendTo("body");function M(R){var S=R.page;var Q=$("#data").data("page");for(i=0;i<Q.length;i++){if(typeof Q[i].children!=="undefined"){page_id=Q[i].children[0].id}else{page_id=Q[i].id}if(page_id==S){if(Q[i].children!==undefined){C(b());m(Q[i]);R.page=page_id}else{C(e());$("#data").data("grid"+S,"");$('<div id="page'+S+'"></div>').appendTo("#menu")}u(R)}}}function m(R){var Q=Ext.getCmp("panel-tab");Q.removeAll();for(x=0;x<R.children.length;x++){id=R.children[x].id;$('<div id="page'+id+'" class="gridster"></div>').appendTo("body");$("#data").data("grid"+id,"");Q.add({title:R.children[x].title,id:id,contentEl:"page"+id,autoScroll:true,listeners:{activate:function(S){obj={};obj.page=S.id;u(obj)}},})}Q.setActiveTab(0)}function C(R){var T=$("#data").data("active-panel");$("#data").data("year",false);var Q=Ext.getCmp("viewport");try{Q.remove(T,true)}catch(S){}$('<div id="menu" class="gridster"></div>').appendTo("body");try{Q.add(R)}catch(S){}Q.doLayout();$("#data").data("active-panel",R.id)}function u(R){var Q=R.page;console.log("initiating grid");$("#data").data("page_id",Q);if($("#data").data("grid"+Q)!==undefined&&$("#data").data("grid"+Q)!==""){return}R.grid=$("#page"+Q).gridster({widget_margins:[10,10],widget_base_dimensions:[120,120],max_size_x:10,max_size_y:10,draggable:{stop:function(S,T){j(JSON.stringify(R.grid.serialize()))}},serialize_params:function(T,S){return{id:S.el[0].id,col:S.col,row:S.row,size_y:S.size_y,size_x:S.size_x,pagewindow:T.context.attributes.pagewindow.value,}}}).data("gridster");R.grid.disable();$("#data").data("grid"+Q,R.grid);$.ajax({type:"GET",url:"/api/pagewindow/?page="+Q,success:function(S){$("#data").data("grid_data"+Q,S);for(i=0;i<S.length;i++){J(S[i],i,R)}}})}function J(T,V,S,U){if(typeof S.fund=="undefined"){S.fund=$("#data").data("fund")}function aa(af,ag,ae){if(typeof Ext.getCmp("grid"+af)=="undefined"){fields=[];for(V=0;V<ag.columns.length;V++){fields[V]=ag.columns[V].dataIndex}Ext.create("Ext.data.Store",{storeId:"store"+af,fields:fields,data:ag,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});return Ext.create("Ext.grid.Panel",{store:Ext.data.StoreManager.lookup("store"+af),columns:ag.columns,id:"grid"+af,border:false,flex:ae,forceFit:true,layout:"fit",margin:"0 0 20 0",})}}function R(af){var ae=af.split("-");if(typeof ae[1]=="undefined"){ae[1]=1;ae[0]=af;af=af+"-1"}$.getJSON("/api/widget/fundsubredtable/?fund="+S.fund+"&year="+ae[0]+"&month="+ae[1]+"&column_width=80,80",function(ag){tab=Ext.getCmp(af);var ah=aa(af,ag,0);tab.add(ah);$.getJSON("/api/widget/subscriptionredemptionmonth/?fund="+S.fund+"&year="+ae[0]+"&month="+ae[1]+"&column_width=100,100",function(aj){tab=Ext.getCmp(af);var ai=aa("client"+af,aj,1);tab.add(ai)})})}function ac(af,ae){$.getJSON("/api/widget/fundgrossasset1/?fund="+S.fund+"&year="+ae+"&column_width=160,85",function(ah){var ag=a(ah,T.window);af.insert(0,ag);af.doLayout()})}function W(ae){fund=$("#data").data("fund");var af=ae.toString().slice(-1);if($.isNumeric(af)==false){if(ae=="ann_return"){ae="si"}else{if(ae!="si"){ae=ae+"1"}}}if(typeof Ext.getCmp("grid"+ae)=="undefined"){tab=Ext.getCmp(ae);$.getJSON("/api/widget/fundperfmonth/?fund="+fund+"&fields="+ae+"&column_width=55,60",function(ak){var aj=aa(ae,ak);tab.add(aj);var ag="inner-tab"+ae;$('<div id="'+ag+'-bar"></div>').appendTo("#"+X);$('<div id="'+ag+'-line"></div>').appendTo("#"+X);widget={};widget.url="";widget.qs="/api/widget/fundperfbenchcompline/?fields="+ae+"&fund="+fund;widget.size_y=3;widget.size_x=6;widget.params={};widget.params.title="";widget.params.date_type="month";widget.params.navigator="true";widget.params.rangeSelector="true";var ah=$("#"+ag+"-bar").highcharts();if(typeof ah=="undefined"){widget.params.type="line";l("",widget,ag+"-line")}var ai=new Ext.TabPanel({id:"inner-tab-id"+ae,height:600,activeTab:0,items:[{title:"Line Graph",id:"line"+ae,contentEl:ag+"-line",},{title:"Bar Chart",id:"bar"+ae,contentEl:ag+"-bar",},],listeners:{tabchange:function(an,am){if(am.id=="bar"+ae){div2=ag+"-bar";var al=$("#"+div2).highcharts();if(typeof al=="undefined"){widget.params.type="column";l("",widget,div2)}}}}});tab.add(ai)})}}var Z=S.page;var Q=$("#data").data("grid"+Z);var Y='<div id="'+Z+"_"+T.window.id+'" pagewindow="'+T.id+'" class="layout_block"></div>';Q.add_widget(Y,T.window.size_x,T.window.size_y,T.col,T.row);var ad="page_"+Z+"_"+T.window.id;$('<div id="'+ad+'"></div>').appendTo("body");if(T.window.key=="w15"){$.getJSON("/api/widget/fundsummary/"+S.fund,function(ae){d(T.window.id,Z,T.window.name,T.window.size_x,T.window.size_y,T.id,ad);html='<div> <table width="100%" class="html_table"><tr><td>Fund Name</td><td>'+ae.name+"</td></tr><tr><td>Fund Type</td><td>"+ae.fund_type.name+"</td></tr><tr><td>Fund Manager</td><td>"+ae.manager.first_name+ae.manager.last_name+"</td></tr><tr><td> Description</td><td>"+ae.description+"<d></tr><tr><td>Custodian</td><td>"+ae.custodian.name+"</td><td>"+ae.custodian.contact_name+"</td><td>"+ae.custodian.contact_number+"</td><td>Managment Fee</td><td>"+ae.management_fee+"</td><td>Performance Fee</td><td>"+ae.performance_fee+"</td></tr><tr><td>Administrator</td><td>"+ae.administrator.name+"</td><td>"+ae.administrator.contact_name+"</td><td>"+ae.administrator.contact_number+"</td><td>Administrator Fee</td><td>"+ae.administrator.fee+"</td></tr><tr><td>Auditor</td><td>"+ae.auditor.name+"</td><td>"+ae.auditor.contact_name+"</td><td>"+ae.auditor.contact_number+"</td><td>Auditor Fee</td><td>"+ae.auditor.fee+"</td></tr><tr><td>Subscription Terms</td><td>"+ae.subscription_frequency+"</td></tr><tr><td>Redemption Terms</td><td>"+ae.redemption_frequency+"</td></tr><tr><td>Management Fees</td><td>"+ae.management_fee+"</td></tr><tr><td>Performance Fees</td><td>"+ae.performance_fee+"</td></tr><tr><td>Benchmark</td><td>"+ae.benchmark.name+"</td></tr></table> </div>";$(html).appendTo("#"+ad)});return}if(T.window.key=="w18"){parents=[{id:"ann_return",title:"Returns"},{id:"ann_volatility",title:"Volatility"},{id:"sharpe_ratio",title:"Sharpe"},{id:"alpha",title:"Alpha"},{id:"beta",title:"Beta"},{id:"correlation",title:"Correlation"},];children=[{id:"1",title:"1 Year Rolling Annualised"},{id:"3",title:"3 Years Rolling Annualised"},{id:"5",title:"5 Years Rolling Annualised"},];items=[];for(V=0;V<parents.length;V++){childItems=[];if(parents[V].id=="ann_return"){childItems.push({id:"si",title:"Since Inception"})}for(x=0;x<children.length;x++){childItems.push({id:parents[V].id+children[x].id,title:children[x].title,layout:"fit",})}items.push({xtype:"tabpanel",title:parents[V].title,id:"w18-parent-"+parents[V].id,activeTab:0,items:childItems,listeners:{tabchange:function(af,ae){W(ae.id)}}})}var X="tab-"+T.window.key+"-"+ad;$('<div id="'+X+'"></div>').appendTo("#"+ad);var ab=new Ext.TabPanel({renderTo:X,id:"w18-tabs",activeTab:0,items:items,layout:"fit",listeners:{beforetabchange:function(af,ae){if(ae.id=="summary-tab"){v();return false}var ag=ae.id.split("-");W(ag[2])}}});W("si");ab.add({title:"Summary",id:"summary-tab",});return d(T.window.id,Z,T.window.name,T.window.size_x,T.window.size_y,T.id,ad)}else{if(T.window.key=="w23"){this_year=new Date().getFullYear();parents=[];items=[];children=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(V=this_year;V>2002;V--){parents.push(V)}for(V=0;V<parents.length;V++){childItems=[];for(x=0;x<children.length;x++){childItems.push({id:parents[V]+"-"+(1+x),title:children[x],layout:{type:"vbox",align:"stretch"}})}items.push({xtype:"tabpanel",title:parents[V],id:"w23-parent-"+parents[V],activeTab:0,items:childItems,listeners:{tabchange:function(af,ae){R(ae.id)}}})}var X="tab-"+T.window.key+"-"+ad;$('<div id="'+X+'"></div>').appendTo("#"+ad);var ab=new Ext.TabPanel({renderTo:X,id:"w23-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(af,ae){var ag=ae.id.split("-");R(ag[2])}}});R(this_year+"-1");return d(T.window.id,Z,T.window.name,T.window.size_x,T.window.size_y,T.id,ad)}}if(T.window.key=="w13"){this_year=new Date().getFullYear();parents=[];items=[];for(V=this_year;V>2002;V--){parents.push(V)}for(V=0;V<parents.length;V++){items.push({title:parents[V],id:"w13-year-"+parents[V],})}var X="tab-"+T.window.key+"-"+ad;$('<div id="'+X+'"></div>').appendTo("#"+ad);var ab=new Ext.TabPanel({renderTo:X,id:"w13-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(af,ae){var ag=ae.id.split("-");ac(ae,ag[2])}}});tab=Ext.getCmp("w13-year-"+this_year);ac(tab,this_year);return d(T.window.id,Z,T.window.name,T.window.size_x,T.window.size_y,T.id,ad)}$.ajax({type:"GET",url:"/api/widgets/?window="+T.window.id,ajaxI:V,success:function(ah){I=this.ajaxI;var ai=T.window.layout+"box";var af=[];for(x=0;x<ah.length;x++){var ag="page_"+Z+"_win_"+T.window.id+"_widget_"+ah[x].id;$('<div id="'+ag+'"></div>').appendTo("#"+ad);var ae=K(S,ah[x],ag);af[x]={contentEl:ag,height:(120*ah[x].size_y)+(10*ah[x].size_y)+(10*(ah[x].size_y-1)),width:(120*ah[x].size_x)+(10*ah[x].size_x)+(10*(ah[x].size_x-1)),border:false,autoScroll:true,}}Ext.create("Ext.container.Container",{renderTo:ad,autoFit:true,header:true,layout:ai,items:af,});d(T.window.id,Z,T.window.name,T.window.size_x,T.window.size_y,T.id,ad)}})}function d(T,V,W,R,Q,S,U){if(typeof $("#data").data("fund_name")!="undefined"){W=W.replace("FUND_NAME",$("#data").data("fund_name"));W=W.replace("DATE",moment().format("YYYY"))}Ext.create("Ext.window.Window",{title:W,height:(120*Q)+(10*Q)+(10*(Q-1))-10,width:(120*R)+(10*R)+(10*(R-1))-10,layout:"auto",floatable:false,draggable:false,closable:false,contentEl:U,x:0,y:0,renderTo:V+"_"+T,id:"page_"+V+"_win_"+T,tools:[{type:"close",handler:function(aa,Z,Y,X){Ext.Msg.show({title:"Remove Widget?",msg:"You want to remove the widget from this page?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.CONFIRM,fn:function(ac){if(ac=="ok"){var ab=$("#data").data("grid"+V);ab.remove_widget($("#"+V+"_"+T));H(S)}}})}}],}).show()}function H(Q){$.ajax({type:"DELETE",url:"/api/pagewindow/"+Q+"/",success:function(){},error:function(R){},})}function K(U,T,W,S){if(typeof U.fund=="undefined"){U.fund=$("#data").data("fund")}if(typeof S!="undefined"){$.each(S,function(X,Y){T.qs=T.qs.replace(X.toUpperCase(),Y)})}$.each(T.params,function(X,Y){T.qs=T.qs.replace(X.toUpperCase(),Y)});if(typeof U.year=="undefined"||typeof U.month=="undefined"){U.year=new Date().getFullYear();U.month=new Date().getMonth()+1}T.div=W;if(T.v2==true){var R="/api/"}else{var R="/api/widget/"}T.url=R+T.key+"/";$.each(U,function(X,Y){T.qs=T.qs.replace(X.toUpperCase(),Y)});if(T.type=="data_table"){return A(U,T,W)}else{if(T.type=="data_table_sub"){return A(U,T,W)}else{if(T.type=="data_group_table"){return N(U,T,W)}else{if(T.type=="line_chart"){return l(U,T,W)}else{if(T.type=="chart_doubley"){E(U,T,W)}else{if(T.type=="bar_chart"){var V=new Date();V.setDate(1);V.setHours(-1);var Q=U.year+"-"+U.month+"-"+V.getDate();T.qs=T.qs.replace("DATE",Q);return o(U,T,W)}else{if(T.type=="line_bar_chart"){$("#data").data("linebar-div",W);$("#"+W).append("<p>Please select a Holding above</p>")}else{if(T.type=="pie_chart"){return L(U,T,W)}else{if(T.type=="euro_percent_table"){return G(U,T,W)}}}}}}}}}}function l(T,U,Q){if(typeof $("#"+Q).highcharts()!="undefined"){}if(typeof U.params.type=="undefined"){var X="line"}else{var X=U.params.type}var Y=false;if(typeof U.params.title!="undefined"&&U.params.title=="true"){Y=U.name}var S=true;if(typeof U.params.yDecimals!="undefined"&&U.params.yDecimals==="false"){S=false}var R="Performance";if(typeof U.params.yAxisTitle!="undefined"){if(U.params.yAxisTitle=="false"){R=false}else{R=U.params.yAxisTitle}}var V=true;if(typeof U.params.labels!="undefined"&&U.params.labels=="false"){V=false}var aa=true;if(typeof U.params.legend!="undefined"&&U.params.legend=="false"){aa=false}var ab=false;if(typeof U.params.scrollbar!="undefined"&&U.params.scrollbar=="true"){ab=true}var Z=false;if(typeof U.params.navigator!="undefined"&&U.params.navigator=="true"){Z=true}var W=true;if(typeof U.params.rangeSelector!="undefined"&&U.params.rangeSelector=="false"){W=false}$.getJSON(U.url+U.qs,function(ae){var ac={chart:{type:X,marginRight:25,size:"100%",renderTo:Q,width:(120*U.size_x)+(10*U.size_x)+(10*(U.size_x-1))-10,height:(120*U.size_y)+(10*U.size_y)+(10*(U.size_y-1)),},navigator:{enabled:Z,adaptToUpdatedData:false,series:ae,height:20,},scrollbar:{enabled:ab},rangeSelector:{enabled:W,selected:4},title:{text:Y,},xAxis:{gridLineWidth:1,},yAxis:{title:{text:R,},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{},legend:{enabled:aa,},series:ae,};if(typeof U.params.date_type!="undefined"&&U.params.date_type=="month"){ac.rangeSelector={enabled:true,buttons:[{type:"year",count:1,text:"1y"},{type:"year",count:5,text:"5y"},{type:"year",count:10,text:"10y"},{type:"all",text:"All"}],inputEnabled:false,selected:1}}if(typeof U.params.zoom!="undefined"&&U.params.zoom=="true"){ac.xAxis={events:{afterSetExtremes:function(af){zoomGraph(af,U)}},minRange:3600*1000}}var ad=new Highcharts.StockChart(ac)})}function E(S,R,T){if(typeof R.params.type=="undefined"){var Q="line"}else{var Q=R.params.type}$.getJSON(R.url+R.qs,function(V){var U=new Highcharts.StockChart({chart:{type:Q,renderTo:T,width:(120*R.size_x)+(10*R.size_x)+(10*(R.size_x-1))-50,height:(120*R.size_y)+(10*R.size_y)+(10*(R.size_y-1))-100,},navigator:{enabled:true,},scrollbar:{enabled:false},rangeSelector:{},title:{text:false},yAxis:[{},{opposite:true}],series:V})})}function o(R,Q,S){$.getJSON(Q.url+Q.qs,function(V){title=false;if(typeof Q.params.title!="undefined"&&Q.params.title=="true"){title=Q.name}type="column";if(typeof Q.params.type!="undefined"){type=Q.params.type}yDecimals=true;if(typeof Q.params.yDecimals!="undefined"&&Q.params.yDecimals==="false"){yDecimals=false}legend=true;if(typeof Q.params.legend!="undefined"&&Q.params.legend=="false"){legend=false}scrollbar=false;if(typeof Q.params.scrollbar!="undefined"&&Q.params.scrollbar=="true"){scrollbar=true}var T={chart:{renderTo:S,type:type,width:(120*Q.size_x)+(10*Q.size_x)+(10*(Q.size_x-1))-30,height:(120*Q.size_y)+(10*Q.size_y)+(10*(Q.size_y-1))-35,},title:{text:false},subtitle:{text:false},yAxis:{title:{text:false,},allowDecimals:yDecimals,},legend:{enabled:legend,},series:[{data:V,color:"white"}],exporting:{enabled:true},xAxis:{type:"category",categories:V.columns,},series:V.objects,};if(typeof Q.params.labels!="undefined"&&Q.params.labels=="rotated"){labels={rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"}};T.xAxis.labels=labels}var U=new Highcharts.Chart(T);$("#data").data("div-"+Q.key,S)})}function z(R,S){var Q=$("#data").data("fund");$('<div id="calendar"></div>').appendTo("body");mo_widget={};mo_widget.url="/api/widget/fundperfhistcalview/";mo_widget.qs="?fund="+Q+"&order_by=weight&value_date__year="+R+"&value_date__month="+S;$.getJSON(mo_widget.url+mo_widget.qs,function(W){var aa=new Date(R,S-1,1);var U=aa.getDay();var T=new Date(R,S,0);var X=T.getDate();var Y='<table class="month_table"><tr>';if(U<6){for(i=1;i<U;i++){Y+="<td></td>"}}days={};for(i=0;i<W.length;i++){var ab=W[i].date.substr(8,2);ab=parseInt(ab,10);days[ab]=W[i].value}for(i=1;i<=X;i++){if(typeof days[i]!="undefined"){var V=days[i]}else{var V=0}date=R.toString()+"-"+S.toString()+"-"+i;var aa=new Date(date);if(aa.getDay()==6||aa.getDay()==0){if(aa.getDay()==0&&i==1){continue}else{if(aa.getDay()==6&&i==1){i++;continue}else{Y+="</tr><tr>";i++;continue}}}Y+="<td>"+i+'<a href="#" onclick="refreshHoldPerfBar(\''+date+"', "+Q+');">'+V+"</a></td>"}Y+="</tr></table>";var Z=new Ext.Window({renderTo:Ext.getBody(),html:Y,height:300,width:400,});Z.show();return;Ext.create("Ext.container.Container",{id:"month-table",width:400,renderTo:div,items:[{id:"month-table-content",xtype:"container",html:Y,}]})})}function g(S,R,T){fund=$("#data").data("fund");fields=[];for(i=0;i<R.columns.length;i++){fields[i]=R.columns[i].dataIndex}Ext.create("Ext.data.Store",{storeId:S.key,fields:fields,data:R,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});plugins=[];selModel=[];if(S.window.key=="w10"&&$("#data").data("classification")=="eof"){plugins=[{ptype:"rowexpander",rowBodyTpl:['<div id="innergrid-'+S.id+'-{id}">',"</div>"]}];selModel={selType:"cellmodel"}}var Q=Ext.create("Ext.grid.Panel",{title:S.params.title,store:Ext.data.StoreManager.lookup(S.key),columns:R.columns,height:(120*S.size_y)+(10*S.size_y)+(10*(S.size_y-1))-20,width:(120*S.size_x)+(10*S.size_x)+(10*(S.size_x-1))-20,layout:{type:"vbox",align:"stretch"},plugins:plugins,selModel:selModel,forceFit:true,layout:"fit",listeners:{cellclick:function(Z,Y,W,U){year=obj.page=$("#data").data("year");month=W;if(month!=0){if(typeof year=="undefined"||year===false){year=new Date().getFullYear()}obj.page=$("#data").data("page_id");obj.grid=$("#data").data("grid"+obj.page);extra_params={year:year,};if(S.window.key=="w8"){group="sec"}else{if(S.window.key=="w9"){group="sub"}else{if(S.window.key=="w10"){group="loc"}}}T=$("#data").data("piechart-div-"+S.window.key);var X="page_"+obj.page+"_win_"+S.window.id;S.key="fundperfgrouppie";S.qs="?fund="+fund+"&value_date__year=YEAR&value_date__month="+month+"&holding_category__holding_group="+group+"&fields=nav&value_date__day=1";S.params.value_date__year=year;S.params.holding_category__holding_group="sec";S.params.fund="FUND";S.params.fields="nav";S.type="pie_chart";var V=$("#"+T).highcharts();V.destroy();K(obj,S,T,extra_params)}}}});if(S.window.key=="w10"&&$("#data").data("classification")=="eof"){Q.view.on("expandBody",function(X,V,U,W){if(typeof $("#data").data("year")=="undefined"||$("#data").data("year")=="false"){year=new Date().getFullYear()}else{year=$("#data").data("year")}var Y=V.get("id");$.getJSON("/api/country-breakdown/?fund="+fund+"&holding_category="+Y+"&value_date__year="+year+"&date=value_date&name=country__name&value=mtd&fields=value_date,country__name,mtd,si,ytd",function(Z){displayInnerGrid(S,Z,Y)});if(typeof $("#data").data("last-open-subgrid")!="undefined"){}});Q.view.on("collapsebody",function(X,V,U,W){destroyInnerGrid(V,S.id)})}return Q}function G(R,Q,S){fund=$("#data").data("fund");$.getJSON(Q.url+Q.qs,function(W){var V=S+"_"+S;$('<div id="'+V+'"></div>').appendTo("#"+S);if(typeof Ext.getCmp(S)!="undefined"){X=Ext.getCmp(S);X.destroy()}var X=Ext.create("Ext.tab.Panel",{renderTo:V,id:V,});Q.params.title="€";var U=g(Q,W);X.add(U);X.doLayout();var T=Q.qs.replace("fields=nav","fields=weight");Q.params.title="% of Fund";$.getJSON(Q.url+T,function(Z){var Y=g(Q,Z);X.add(Y);X.doLayout()})})}function N(R,Q,S){$.getJSON(Q.url+Q.qs,function(W){var U=$("#data").data("fund");fields=[];c=0;for(i=0;i<W.columns.length;i++){if(typeof W.columns[i].columns!="undefined"){for(x=0;x<W.columns[i].columns.length;x++){fields[c]=W.columns[i].columns[x].dataIndex;c++}}else{if(typeof W.columns[i].dataIndex!="undefined"){fields[c]=W.columns[i].dataIndex;c++}}}fields.push("group");var T=Ext.create("Ext.data.Store",{storeId:"groupStore",fields:fields,groupField:"group",data:W,proxy:{type:"memory",reader:{type:"json",root:"rows"}}});var V=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}",collapsible:false,depthToIndent:100,enableGroupingMenu:false,});return Ext.create("Ext.grid.Panel",{columnLines:true,cls:"custom-grid-group",store:Ext.data.StoreManager.lookup("groupStore"),columns:W.columns,features:[V],renderTo:S,width:(120*Q.size_x)+(10*Q.size_x)+(10*(Q.size_x-1)),height:(120*Q.size_y)+(10*Q.size_y)+(10*(Q.size_y-1)),forceFit:true,layout:"fit",})})}function a(U,T){var R=$("#data").data("fund");fields=[];c=0;for(i=0;i<U.columns.length;i++){if(typeof U.columns[i].columns!="undefined"){for(x=0;x<U.columns[i].columns.length;x++){fields[c]=U.columns[i].columns[x].dataIndex;c++}}else{if(typeof U.columns[i].dataIndex!="undefined"){fields[c]=U.columns[i].dataIndex;c++}}}fields.push("group");var Q=Ext.create("Ext.data.Store",{storeId:"groupStore",fields:fields,groupField:"group",data:U,proxy:{type:"memory",reader:{type:"json",root:"rows"}}});var S=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});return Ext.create("Ext.grid.Panel",{columnLines:true,store:Ext.data.StoreManager.lookup("groupStore"),columns:U.columns,features:[S],width:(120*T.size_x)+(10*T.size_x)+(10*(T.size_x-1)),height:(120*T.size_y)+(10*T.size_y)+(10*(T.size_y-1)),forceFit:true,layout:"fit",})}function A(S,R,T){var Q=false;if(typeof R.params.column_header!=="undefined"&&R.params.column_header=="false"){Q=true}$.getJSON(R.url+R.qs,function(X){c=0;fields=[];for(i=0;i<X.columns.length;i++){if(typeof X.columns[i].columns!="undefined"){for(x=0;x<X.columns[i].columns.length;x++){fields[c]=X.columns[i].columns[x].dataIndex;c++}}else{if(typeof X.columns[i].dataIndex!="undefined"){fields[c]=X.columns[i].dataIndex;c++}}}Ext.create("Ext.data.Store",{storeId:R.key,fields:fields,data:X.rows,proxy:{type:"memory",reader:{type:"json",root:"rows"}},sortInfo:{direction:"DESC",field:"year"},});if(R.type=="data_table_sub"){cls="custom-grid-sub"}else{cls="custom-grid"}var W=(120*R.size_x)+(10*R.size_x)+(10*(R.size_x-1));var U=(120*R.size_y)+(10*R.size_y)+(10*(R.size_y-1));plugins=[{ptype:"rowexpander",rowBodyTpl:['<div id="innergrid-'+R.id+'-{id}">',"</div>"]}];selModel={selType:"cellmodel"};W=W-23;var V=Ext.create("Ext.grid.Panel",{id:T,cls:cls,columnLines:true,hideHeaders:Q,store:Ext.data.StoreManager.lookup(R.key),columns:X.columns,width:W,height:U,header:false,border:false,autoScroll:true,renderTo:T,plugins:plugins,selModel:selModel,iconCls:"icon-grid",forceFit:true,layout:"fit",listeners:{cellclick:function(ab,aa,Z,Y){year=Y.data.year;S.page=$("#data").data("page_id");S.grid=$("#data").data("grid"+S.page);extra_params={year:year,};month=Z;if(R.window.key=="w1"){if(Z==1){if($("#data").data("classification")=="sp"){f("w9c",S,extra_params);f("w26",S,extra_params);f("w27",S,extra_params);f("w28",S,extra_params)}else{if($("#data").data("classification")=="pe"){f("w5",S,extra_params)}else{f("w3",S,extra_params);f("w4",S,extra_params);f("w5",S,extra_params)}}}else{if(Z<14){if($("#data").data("classification")=="pe"){f("w2",S,extra_params)}else{refreshHoldPerfBar(year+"-"+month+"-1",S.fund,true)}}}}else{if(R.window.key=="w1b"){if(Z==1){f("w3",S,extra_params);f("w4b",S,extra_params);f("w5b",S,extra_params)}else{if(Z<14){refreshHoldPerfBar(year+"-"+month+"-1",S.fund,true);z(year,month)}}}}if(R.window.key=="w6"){if(Z==1){$("#data").data("year",year);f("w8",S,extra_params);f("w9",S,extra_params);f("w10",S,extra_params)}else{if(Z<13){refreshHoldPerfBar(year+"-"+month+"-1",S.fund,true,"performance","weight")}}}}}});V.view.on("expandBody",function(ab,Z,Y,aa){var ac=Z.get("id");if(R.key=="fundperfholdtable"){$.getJSON("/api/widget/fundperfholdtradetable/?holding="+ac+"&holding__fund="+S.fund+"&column_width=150,80",function(ad){displayInnerGrid(R,ad,ac);R.holding=Z.get("id");R.fund=S.fund;lineBarChart(R)})}else{if(R.key=="fundregister"){$.getJSON("/api/widget/subscriptionredemption/?&fund="+S.fund+"&client="+ac+"&column_width=100,100",function(ad){displayInnerGrid(R,ad,ac)})}}if(typeof $("#data").data("year")=="undefined"||$("#data").data("year")===false){year=new Date().getFullYear()}else{year=$("#data").data("year")}fund=$("#data").data("fund");if(R.window.key=="w5b"){$.getJSON("/api/country-breakdown/?fund="+fund+"&holding_category="+ac+"&value_date__year="+year+"&date=value_date&name=country__name&value=mtd&fields=id,value_date,country__name,mtd,si,ytd&column_width=80,50",function(ad){displayInnerGrid(R,ad,ac,true,50)})}if(R.window.key=="w31"){$.getJSON("/api/holding-history/?holding="+ac+"&holding_category__holding_group__isnull=true&value_date__year="+year+"&date_type=m&fields=value_date,drawdown,various,distribution,expense,valuation,total_value&total=true&column_width=80,50",function(ad){displayInnerGrid(R,ad,ac,false,150)})}if(R.window.key=="w12b"){$.getJSON("/api/holding/?client="+ac+"&distinct=true&total=true&fields=name,currency__name,commit,drawdown,various,residual_commit,distribution,valuation,total_value,proceed,irr",function(ad){displayInnerGrid(R,ad,ac,false,150)})}if(typeof $("#data").data("last-open-subgrid")!="undefined"){}});V.view.on("collapsebody",function(ab,Z,Y,aa){destroyInnerGrid(Z,R.id)});return V})}function f(R,S,Q){$.getJSON("/api/widgets/?window__key="+R,function(T){for(x=0;x<T.length;x++){var X="page_"+S.page+"_win_"+T[x].window.id;var U=X+"_widget_"+T[x].id;var Y=T[x].window.name;if(Q.year!="undefined"){date=Q.year}else{date="Week X"}Y=Y.replace("FUND_NAME",$("#data").data("fund_name"));Y=Y.replace("DATE",date);D=Ext.getCmp(X);D.setTitle(Y);if(T[x].type=="data_table"){var V=Ext.getCmp(U)}else{var V=$("#"+U).highcharts()}try{V.destroy()}catch(W){}$('<div id="'+U+'"></div>').appendTo("#"+X);K(S,T[x],U,Q)}})}function h(R,Q,S){$.getJSON(Q.url+Q.qs,function(T){fields=["id"];for(i=0;i<T.columns.length;i++){fields[i]=T.columns[i].dataIndex}var U=Ext.create("Ext.data.Store",{fields:fields,data:T.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var V=Ext.create("Ext.grid.Panel",{store:U,columns:T.columns,columnLines:true,cls:"custom-grid",selModel:{selType:"cellmodel"},width:(140*Q.size_x)+(10*Q.size_x)+(10*(Q.size_x-1)),height:(140*Q.size_y)+(10*Q.size_y)+(10*(Q.size_y-1)),plugins:[{ptype:"rowexpander",rowBodyTpl:['<div id="innergrid-'+Q.id+'-{id}">',"</div>"]}],header:false,border:0,iconCls:"icon-grid",renderTo:S,id:"subtable"+Q.key,});V.view.on("expandBody",function(Z,X,W,Y){var aa=X.get("id");if(Q.key=="fundperfholdtable"){$.getJSON("/api/widget/fundperfholdtradetable/?holding="+aa+"&holding__fund="+R.fund+"&column_width=150,80",function(ab){displayInnerGrid(Q,ab,aa);Q.holding=X.get("id");Q.fund=R.fund;lineBarChart(Q)})}else{if(Q.key=="fundregister"){$.getJSON("/api/widget/subscriptionredemption/?&fund="+R.fund+"&client="+aa+"&column_width=100,100",function(ab){displayInnerGrid(Q,ab,aa)})}}if(typeof $("#data").data("year")=="undefined"||$("#data").data("year")===false){year=new Date().getFullYear()}else{year=$("#data").data("year")}fund=$("#data").data("fund");if(Q.window.key=="w5b"){$.getJSON("/api/country-breakdown/?fund="+fund+"&holding_category="+aa+"&value_date__year="+year+"&date=value_date&name=country__name&value=mtd&fields=id,value_date,country__name,mtd,si,ytd&column_width=80,50",function(ab){displayInnerGrid(Q,ab,aa,true,50)})}if(Q.window.key=="w31"){$.getJSON("/api/holding-history/?holding="+aa+"&holding_category__holding_group__isnull=true&value_date__year="+year+"&date_type=m&fields=value_date,drawdown,various,distribution,expense,valuation,total_value&total=true&column_width=80,50",function(ab){displayInnerGrid(Q,ab,aa,false,150)})}if(Q.window.key=="w12b"){$.getJSON("/api/holding/?client="+aa+"&distinct=true&total=true&fields=name,currency__name,commit,drawdown,various,residual_commit,distribution,valuation,total_value,proceed,irr",function(ab){displayInnerGrid(Q,ab,aa,false,150)})}if(typeof $("#data").data("last-open-subgrid")!="undefined"){}});panel.view.on("collapsebody",function(Z,X,W,Y){destroyInnerGrid(X,Q.id)})})}function L(R,Q,S){$("#data").data("piechart-div-"+Q.window.key,S);if(Q.key=="fundnavpie"){$("#data").data("linebar-div",S);$("#"+S).append("<p>Please click on a month</p>");return}$.getJSON(Q.url+Q.qs,function(U){var T=new Highcharts.Chart({chart:{renderTo:S,marginTop:-50,marginLeft:30,marginRight:30,height:(120*2)+(10*2)+(10*(2-1)),width:(120*2)+(10*2)+(10*(2-1)),},title:{text:false},series:[{type:"pie",name:Q.name,data:U}]})})}function r(Q){setInterval(function(){try{var R=Ext.StoreMgr.lookup(Q);R.reload()}catch(S){}},2000)}function t(){var R=new Array();window.oldSetInterval=window.setInterval;window.setInterval=function(T,S){R.push(oldSetInterval(T,S))};for(var Q in R){window.clearInterval(Q)}}Ext.QuickTips.init();function s(){var Q=$("#data").data("page_id");$.ajax({type:"GET",url:"/api/widget/unused/?page="+Q,success:function(R){var S=Ext.create("Ext.data.Store",{storeId:"widgets",fields:["name","widget_type"],groupField:"widget_type",autoLoad:true,proxy:{data:R,type:"memory",reader:{type:"json",}},});var U=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})'});var T=Ext.create("Ext.grid.Panel",{iconCls:"icon-grid",frame:true,store:S,header:false,region:"west",width:"60%",bodyBorder:false,hideHeaders:true,features:[U],columns:[{text:"Widget",flex:1,dataIndex:"name",},{text:"Type",flex:1,dataIndex:"widget_type",hidden:true,}],listeners:{itemclick:function(Y,W){$.ajax({type:"GET",url:"/api/widget/info/"+W.data.id,success:function(aa){$("#data").data("widget",aa);html='<div class="widget_desc"><img src="'+STATIC_URL+"widget-images/"+aa.key+'.png"></img><h1>'+aa.name+"</h1>"+aa.description+"</div>";var ab=Ext.getCmp("widget_desc");ab.update(html)},dataType:"json",contentType:"application/json",error:function(aa){}});try{var X=Ext.getCmp("add_widget_btn");X.enable()}catch(Z){}}}});var V=Ext.create("Ext.window.Window",{title:"Layout Window",closable:true,title:"Add Widget",width:"50%",height:"50%",layout:"border",items:[T,{region:"center",autoScroll:true,id:"widget_desc",html:'<div class="widget_preview">&#60;Preview&#62;</div>',}],buttonAlign:"right",buttons:[{scope:this,text:"Cancel",iconCls:"icon-cancel",handler:function(){V.close()}},{scope:this,text:"Add",iconCls:"icon-ok",disabled:true,id:"add_widget_btn",handler:function(){data=$("#data").data("widget");page=$("#data").data("page_id");T={};T.widget=data.resource_uri;T.page="/api/page/"+page+"/";T.row=1;T.col=1;T.size_y=data.size_y;T.size_x=data.size_x;$.ajax({type:"POST",url:"/api/pagewindow/",data:JSON.stringify(T),dataType:"json",contentType:"application/json",success:function(X){var Y='<div id="'+page+"_"+data.key+'" pagewindow="'+X.id+'" class="layout_block"></div>';var W=$("#data").data("grid"+page);W.add_widget(Y,data.size_x,data.size_y,1,1);K(data,page);d(data.key,page,data.name,data.size_x,data.size_y);V.close()},})}}],}).show()},error:function(R){}})}function j(Q){var Q=$.parseJSON(Q);for(i=0;i<Q.length;i++){data={col:Q[i].col,row:Q[i].row,};$.ajax({type:"PATCH",url:"/api/pagewindow/"+Q[i].pagewindow+"/",data:JSON.stringify(data),dataType:"json",contentType:"application/json",error:function(R){},})}}function e(){return Ext.create("Ext.panel.Panel",{region:"center",id:"panel-home",contentEl:"menu",autoDestroy:true,autoScroll:true,defaults:{autoScroll:true},})}function b(){return Ext.create("Ext.tab.Panel",{region:"center",contentEl:"menu",id:"panel-tab",autoDestroy:true,autoScroll:true,layout:"fit"})}var p=new Ext.menu.Menu({items:[{text:"Resize Widget",id:"resize_widget",},{text:"Remove Widget",id:"remove_widget",}],defaults:{listeners:{click:function(R,Q){if(R.id=="resize_widget"){}else{if(R.id=="remove_widget"){}}}}},});var q=Ext.create("Ext.menu.Menu",{items:[{text:"Change Theme",menu:{items:[{text:"Default",checked:true,group:"theme",id:"theme_default",checkHandler:k},{text:"BlueBay",checked:false,group:"theme",id:"theme_bluebay",checkHandler:k}]}},{text:"Re-order Panels",id:"enable_drag",},{text:"Lock Panels",id:"disable_drag",hidden:true,},{text:"Log out",id:"log_out",}],defaults:{listeners:{click:function(R,Q){page=$("#data").data("page_id");if(R.id=="add_widget"){s()}else{if(R.id=="disable_drag"){$("#data").data("grid"+page).disable();Ext.getCmp("enable_drag").setVisible(true);Ext.getCmp("disable_drag").setVisible(false)}else{if(R.id=="enable_drag"){$("#data").data("grid"+page).enable();Ext.getCmp("disable_drag").setVisible(true);Ext.getCmp("enable_drag").setVisible(false)}else{if(R.id=="log_out"){n()}}}}}}},});function k(R,Q){if(R.id==="theme_bluebay"){var S="extjs-themes/bluebay/css/bluebay.css"}else{if(R.id==="theme_default"){var S="extjs/resources/css/ext-all.css"}}Ext.util.CSS.swapStyleSheet("theme",STATIC_URL+S)}function B(Q){$.ajax({type:"GET",url:"/api/"+Q,success:function(R){$("#data").data(Q,R)}})}function O(Q){$.ajax({type:"GET",url:"/api/fund/"+Q+"?fields=name,classification__key",success:function(R){$("#data").data("fund_name",R.name);$("#data").data("classification",R.classification__key)}})}function w(){$.getJSON("/api/menu/",function(T){var V=Ext.define("tree",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"text",type:"string",mapping:"name"},{name:"page",type:"string"},]});var S=Ext.create("Ext.data.TreeStore",{model:V,proxy:{data:T,type:"memory",reader:{type:"json",}},});var R=Ext.create("Ext.tree.Panel",{id:"main-menu",store:S,rootVisible:false,preventHeader:true,border:false,autoScroll:true,useArrows:true,height:1000,listeners:{itemexpand:{fn:function(W,X){nodeId=W.data.id}},itemclick:{fn:function(X,W,ab,Y,aa,Z){if(W.isExpanded()){W.collapse()}else{W.expand()}if(typeof W.raw.fund!="undefined"){$("#data").data("fund",W.raw.fund);O(W.raw.fund)}if(W.raw.page!==null){if(typeof W.raw.page==="object"){W.raw.page=W.raw.page.id}else{var ac=W.raw.page.toString();W.raw.page=ac.replace(/\D/g,"")}}M(W.raw)}}}});var U=Ext.create("Ext.panel.Panel",{id:"west",region:"west",collapsible:true,title:"Navigation",width:150,items:[R],tools:[{type:"gear",handler:function(Z,Y,X,W){q.showBy(Y,"tr-br?")}}],});var Q=Ext.create("Ext.container.Viewport",{layout:"border",id:"viewport",items:[U,e()]});Ext.EventManager.onWindowResize(Q.doLayout,Q)})}Ext.QuickTips.init();var y=new Ext.FormPanel({labelWidth:80,url:"/api/user/login/",frame:true,defaultType:"textfield",monitorValid:true,header:false,style:"padding:10px",headers:{"Content-Type":"application/json"},items:[{fieldLabel:"Username",name:"username",allowBlank:false},{fieldLabel:"Password",name:"password",inputType:"password",allowBlank:false}],buttons:[{text:"Login",formBind:true,handler:function(){y.getForm().submit({method:"POST",headers:{"Content-Type":"application/json","X-HTTP-Method-Override":"POST"},success:function(){D.close();B("fund");B("page");w();page=new Object();page.page=1;u(page)},failure:function(Q,R){Ext.Msg.alert("Login failed!","Wrong user name or passsword");y.getForm().reset()}})}}],});var D=new Ext.Window({closeAction:"hide",id:"login-window",title:"Please Login",layout:"fit",width:300,height:150,closable:false,resizable:false,plain:true,border:false,items:[y]});$("#data").data("login-window",D);function n(){$.ajax({type:"GET",url:"/api/user/logout/",success:function(Q){var R=$("#data").data("active-panel");Ext.getCmp("west").setVisible(false);Ext.getCmp(R).setVisible(false);$("#data").data("login-window").show()},failure:function(){Ext.Msg.alert("Logout failed!","You could not be logged out.")}})}function P(Q){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(Q))}$.ajaxSetup({crossDomain:false,beforeSend:function(R,Q){if(!P(Q.type)){R.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))}}});$.ajax({type:"GET",url:"/api/loggedin/",success:function(Q){B("page");$('<div id="menu" class="gridster"></div>').appendTo("body");w();$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");page=new Object();page.page=1;u(page)},error:function(){$('<div id="menu" class="gridster"></div>').appendTo("body");$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");D.show()}})});
