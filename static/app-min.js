Ext.Loader.setPath("Ext.ux","http://dabhand.net:8080/static/ext-4.2.0/examples/ux");Ext.require(["Ext.ux.RowExpander"]);Ext.require(["Ext.container.Viewport","Ext.layout.container.Border","Ext.tab.Panel","Ext.tree.*","Ext.data.*","Ext.menu.*","Ext.window.MessageBox","Ext.grid.*",]);function displayInnerGrid(b,d){fields=[];for(i=0;i<b.columns.length;i++){fields[i]=b.columns[i].dataIndex}var e=Ext.create("Ext.data.Store",{fields:fields,data:b.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var a=Ext.create("Ext.grid.Panel",{store:e,selModel:{selType:"cellmodel"},columns:b.columns,header:false,width:1000,height:150,iconCls:"icon-grid",renderTo:"innergrid"+d,});a.getEl().swallowEvent(["mousedown","mouseup","click","contextmenu","mouseover","mouseout","dblclick","mousemove"])}function zoomGraph(k,h){var m=h.qs.replace("&value_date__month=2,4,6,8,10,12","");console.log(k);console.log(h);var b=new Date(k.min);var g=new Date(k.max);var j=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var f="&value_date__gte="+j+"&value_date__lte="+d;range=(k.max/1000)-(k.min/1000);range=Math.round(range);var a="";if(range>300000000){a="&value_date__month=2,4,6,8,10,12"}else{if(range>=240000000){}else{if(range>=120000000){}else{if(range>=60000000){}else{var a=""}}}}var l=$("#"+h.div).highcharts();l.showLoading("Loading data from server...");$.getJSON(h.url+m+f+a,function(e){l.series[0].setData(e[0].data);l.hideLoading()})}function zoomLineBarGraph(k){console.log(k);holding=$("#data").data("holding");var a=$("#data").data("linebar-div");var m="?holding_category__holding_group__isnull=true&holding="+holding;var d=new Date(k.min);var h=new Date(k.max);var j=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();var f=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var g="&value_date__gte="+j+"&value_date__lte="+f;range=(k.max/1000)-(k.min/1000);range=Math.round(range);if(range>31557600){var b="&value_date__month=2,4,6,8,10,12&value_date__day=1"}else{if(range>=31535000){var b="&value_date__week_day=4"}else{if(range>=15535000){var b="&value_date__week_day=3,5"}else{if(range>=7700000){var b="&value_date__week_day=2,4,6"}else{var b=""}}}}var l=$("#"+a).highcharts();l.showLoading("Loading data from server...");$.getJSON("/api/widget/fundperfholdpriceline/"+m+g+b,function(e){l.series[0].setData(e);l.hideLoading();$.getJSON("/api/widget/fundperfholdvolbar/"+m+g+b,function(n){l.series[1].setData(n);l.hideLoading()})})}function lineBarChart(b){b.url="/api/widget/fundperfholdpriceline/";b.qs="?holding_category__holding_group__isnull=true&value_date__month=2,4,6,8,10,12&value_date__day=1&holding__fund="+b.fund+"&holding="+b.holding;$("#data").data("holding",b.holding);var d=$("#data").data("linebar-div");var a=$("#"+d).highcharts();if(typeof a!="undefined"){a.destroy()}$.getJSON(b.url+b.qs,function(e){b.url="/api/widget/fundperfholdvolbar/";$.getJSON(b.url+b.qs,function(h){var f={chart:{renderTo:d,marginTop:5,marginRight:50,},navigator:{enabled:true,adaptToUpdatedData:false,series:{data:e}},scrollbar:{enabled:false,},title:{text:false,},xAxis:[{gridLineWidth:1,type:"datetime",labels:{rotation:-45,align:"right",style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}},events:{afterSetExtremes:zoomLineBarGraph},minRange:3600*1000},{}],yAxis:[{height:180,lineWidth:3,offset:0,gridLineWidth:1,title:{text:"Price",margin:5,}},{top:225,lineWidth:3,gridLineWidth:1,offset:0,height:75,title:{text:"Volume",}},],legend:{enabled:true,verticalAlign:"top",y:-10,},rangeSelector:{enabled:true,buttons:[{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],inputEnabled:false,selected:4},series:[{yAxis:0,name:"Price by time",stack:0,data:e,tooltip:{valueDecimals:2},},{name:"Volume by time",yAxis:1,stack:0,data:h,tooltip:{valueDecimals:2},lineWidth:3,marker:{enabled:false},pointWidth:5,type:"column",},]};var g=new Highcharts.Chart(f)})})}function destroyInnerGrid(a){var b=document.getElementById("innergrid"+a.get("id"));var d=b.firstChild;while(d){d.parentNode.removeChild(d);d=d.nextSibling}}function monthlyBar(d,f,a,h){if(typeof a=="undefined"){a="nav"}if(typeof h=="undefined"){h="weight"}var j=$("#data").data("div-fundperfholdperfbar");var e=$("#"+j).highcharts();var b="/api/widget/fundperfholdperfbar/?value_date="+d+"&fund="+f+"&legend=false&fields="+a+"&order_by="+h+"&holding_category__isnull=true";try{e.destroy();$.getJSON(b,function(l){widget={};widget.size_x=5;widget.size_y=3;var k=new Highcharts.Chart({chart:{renderTo:j,type:"column",width:(120*widget.size_x)+(10*widget.size_x)+(10*(widget.size_x-1))-30,height:(120*widget.size_y)+(10*widget.size_y)+(10*(widget.size_y-1))-35,},title:{text:false,},legend:{enabled:false,},xAxis:{type:"category",categories:l.columns,labels:{rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"},enabled:labels,},},series:l.objects,})})}catch(g){}}Ext.onReady(function(){function v(){graphs={1:[{ann_return1:"Returns one ann"},{ann_volatility1:"Volatility one ann"},{alpha1:"Alpha one ann"},{beta1:"Beta one ann"},{sharpe_ratio1:"Sharpe one ann"},{correlation1:"Correlation one ann"},],2:[{ann_return3:"Returns three ann"},{ann_volatility3:"Volatility three ann"},{alpha3:"Alpha three ann"},{beta3:"Beta three ann"},{sharpe_ratio3:"Sharpe three ann"},{correlation3:"Correlation three ann"},],3:[{ann_return5:"Returns five ann"},{ann_volatility5:"Volatility five ann"},{alpha5:"Alpha five ann"},{beta5:"Beta five ann"},{sharpe_ratio5:"Sharpe five ann"},{correlation5:"Correlation five ann"},]};var P=$("#data").data("fund");items=[];for(var S in graphs){children=[];for(var O in graphs[S]){key=Object.keys(graphs[S][O])[0];var R="summary2-bar-"+key;var Q="summary2-line-"+key;$('<div id="'+R+'"></div>').appendTo("body");$('<div id="'+Q+'"></div>').appendTo("body");win_widget={};win_widget.url="/api/widget/fundperfmonthmin/";win_widget.qs="?fund="+P+"&fields="+key+"&value_date__month=2,4,6,8,10,12";win_widget.size_y=1.9;win_widget.size_x=3;win_widget.div=R;win_widget.params={};win_widget.params.type="column";win_widget.params.legend="false";win_widget.params.scrollbar="false";win_widget.params.navigator="true";win_widget.params.zoom="true";win_widget.params.rangeSelector="true";win_widget.params.title="false";win_widget.params.yAxisTitle=graphs[S][O][key];win_widget.params.date_type="month";l("",win_widget,R);children.push({xtype:"tabpanel",border:1,width:(120*win_widget.size_x)+(10*win_widget.size_x)+(10*(win_widget.size_x-1))-20,height:(120*win_widget.size_y)+(10*win_widget.size_y)+(10*(win_widget.size_y-1))+20,items:[{xtype:"panel",title:"Bar",contentEl:R,id:R},{xtype:"panel",title:"Line",contentEl:Q,id:Q}],listeners:{tabchange:function(U,T){win_widget.params.type="line";l("",win_widget,T.id)}}})}parent={xtype:"container",layout:"hbox",items:children,};items.push(parent)}Ext.onReady(function(){var T=new Ext.Window({renderTo:Ext.getBody(),items:items,listeners:{close:function(V,U){$.each(graphs,function(W,X){$.each(X,function(Y,Z){Y=Object.keys(Z)[0];F("summary2-bar-"+Y);F("summary2-line-"+Y)})})}}});T.toggleMaximize();T.show()})}function F(P){if(typeof $("#"+P).highcharts()!="undefined"){var O=$("#"+P).highcharts();O.destroy()}}$('<div id="data"></div>').appendTo("body");function M(Q){var R=Q.page;var O=$("#data").data("page");for(i=0;i<O.length;i++){if(O[i].id==R){el="page"+R;if(O[i].children!==undefined){var P=b();C(P,el);m(O[i]);Q.page=O[i].children[0].id}else{var P=e();C(P,el);$("#data").data("grid"+R,"");$('<div id="page'+R+'"></div>').appendTo("#menu")}u(Q)}}}function m(P){var O=Ext.getCmp("panel-tab");O.removeAll();for(x=0;x<P.children.length;x++){id=P.children[x].id;$('<div id="page'+id+'" class="gridster"></div>').appendTo("body");$("#data").data("grid"+id,"");O.add({title:P.children[x].title,id:id,contentEl:"page"+id,autoScroll:true,listeners:{activate:function(Q){obj={};obj.page=Q.id;u(obj)}},})}O.setActiveTab(0)}function C(P,Q){var S=$("#data").data("active-panel");var O=Ext.getCmp("viewport");try{O.remove(S)}catch(R){}$('<div id="menu" class="gridster"></div>').appendTo("body");try{O.add(P)}catch(R){}O.doLayout();$("#data").data("active-panel",P.id)}function u(P){var O=P.page;console.log("initiating grid");$("#data").data("page_id",O);if($("#data").data("grid"+O)!==undefined&&$("#data").data("grid"+O)!==""){return}P.grid=$("#page"+O).gridster({widget_margins:[10,10],widget_base_dimensions:[120,120],max_size_x:10,max_size_y:10,draggable:{stop:function(Q,R){j(JSON.stringify(P.grid.serialize()))}},serialize_params:function(R,Q){return{id:Q.el[0].id,col:Q.col,row:Q.row,size_y:Q.size_y,size_x:Q.size_x,pagewindow:R.context.attributes.pagewindow.value,}}}).data("gridster");P.grid.disable();$("#data").data("grid"+O,P.grid);$.ajax({type:"GET",url:"/api/pagewindow/?page="+O,success:function(Q){$("#data").data("grid_data"+O,Q);for(i=0;i<Q.length;i++){J(Q[i],i,P)}}})}function J(R,T,Q,S){if(typeof Q.fund=="undefined"){Q.fund=$("#data").data("fund")}function Y(ad,ae,ac){if(typeof Ext.getCmp("grid"+ad)=="undefined"){fields=[];for(T=0;T<ae.columns.length;T++){fields[T]=ae.columns[T].dataIndex}Ext.create("Ext.data.Store",{storeId:"store"+ad,fields:fields,data:ae,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});return Ext.create("Ext.grid.Panel",{store:Ext.data.StoreManager.lookup("store"+ad),columns:ae.columns,id:"grid"+ad,border:false,flex:ac,})}}function P(ad){var ac=ad.split("-");if(typeof ac[1]=="undefined"){ac[1]=1;ac[0]=ad;ad=ad+"-1"}$.getJSON("/api/widget/fundsubredtable/?fund="+Q.fund+"&year="+ac[0]+"&month="+ac[1],function(ae){tab=Ext.getCmp(ad);var af=Y(ad,ae,0);tab.add(af);$.getJSON("/api/widget/subscriptionredemptionmonth/?fund="+Q.fund+"&year="+ac[0]+"&month="+ac[1],function(ah){tab=Ext.getCmp(ad);var ag=Y("client"+ad,ah,1);tab.add(ag)})})}function aa(ad,ac){$.getJSON("/api/widget/fundgrossasset/?fund="+Q.fund+"&year="+ac,function(af){var ae=a(af,R.window);ad.insert(0,ae);ad.doLayout()})}function U(ac){fund=$("#data").data("fund");var ad=ac.toString().slice(-1);if($.isNumeric(ad)==false){if(ac=="ann_return"){ac="si"}else{if(ac!="si"){ac=ac+"1"}}}if(typeof Ext.getCmp("grid"+ac)=="undefined"){tab=Ext.getCmp(ac);$.getJSON("/api/widget/fundperfmonth/?fund="+fund+"&fields="+ac,function(ai){var ah=Y(ac,ai);tab.add(ah);var ae="inner-tab"+ac;$('<div id="'+ae+'-bar"></div>').appendTo("#"+V);$('<div id="'+ae+'-line"></div>').appendTo("#"+V);widget={};widget.url="";widget.qs="/api/widget/fundperfbenchcompline/?fields="+ac+"&fund="+fund;widget.size_y=3;widget.size_x=6;widget.params={};widget.params.title="";widget.params.date_type="month";widget.params.navigator="true";widget.params.rangeSelector="true";var af=$("#"+ae+"-bar").highcharts();if(typeof af=="undefined"){widget.params.type="column";l("",widget,ae+"-bar")}var ag=new Ext.TabPanel({id:"inner-tab-id"+ac,height:600,activeTab:0,items:[{title:"Bar Chart",id:"bar"+ac,contentEl:ae+"-bar",},{title:"Line Graph",id:"line"+ac,contentEl:ae+"-line",}],listeners:{tabchange:function(al,ak){if(ak.id=="line"+ac){div2=ae+"-line";var aj=$("#"+div2).highcharts();if(typeof aj=="undefined"){widget.params.type="line";l("",widget,div2)}}}}});tab.add(ag)})}}var X=Q.page;var O=$("#data").data("grid"+X);var W='<div id="'+X+"_"+R.window.id+'" pagewindow="'+R.id+'" class="layout_block"></div>';O.add_widget(W,R.window.size_x,R.window.size_y,R.col,R.row);var ab="page_"+X+"_"+R.window.id;$('<div id="'+ab+'"></div>').appendTo("body");if(R.window.key=="w15"){$.getJSON("/api/widget/fundsummary/"+Q.fund,function(ac){d(R.window.id,X,R.window.name,R.window.size_x,R.window.size_y,R.id,ab);html='<div> <table width="100%" class="html_table"><tr><td>Fund Name</td><td>'+ac.name+"</td></tr><tr><td>Fund Type</td><td>"+ac.fund_type.name+"</td></tr><tr><td>Fund Manager</td><td>"+ac.manager.first_name+ac.manager.last_name+"</td></tr><tr><td> Description</td><td>"+ac.description+"<d></tr><tr><td>Custodian</td><td>"+ac.custodian.name+"</td><td>"+ac.custodian.contact_name+"</td><td>"+ac.custodian.contact_number+"</td><td>Managment Fee</td><td>"+ac.management_fee+"</td><td>Performance Fee</td><td>"+ac.performance_fee+"</td></tr><tr><td>Administrator</td><td>"+ac.administrator.name+"</td><td>"+ac.administrator.contact_name+"</td><td>"+ac.administrator.contact_number+"</td><td>Administrator Fee</td><td>"+ac.administrator.fee+"</td></tr><tr><td>Auditor</td><td>"+ac.auditor.name+"</td><td>"+ac.auditor.contact_name+"</td><td>"+ac.auditor.contact_number+"</td><td>Auditor Fee</td><td>"+ac.auditor.fee+"</td></tr><tr><td>Subscription Terms</td><td>"+ac.subscription_frequency+"</td></tr><tr><td>Redemption Terms</td><td>"+ac.redemption_frequency+"</td></tr><tr><td>Management Fees</td><td>"+ac.management_fee+"</td></tr><tr><td>Performance Fees</td><td>"+ac.performance_fee+"</td></tr><tr><td>Benchmark</td><td>"+ac.benchmark.name+"</td></tr></table> </div>";$(html).appendTo("#"+ab)});return}if(R.window.key=="w18"){d(R.window.id,X,R.window.name,R.window.size_x,R.window.size_y,R.id,ab);parents=[{id:"ann_return",title:"Returns"},{id:"ann_volatility",title:"Volatility"},{id:"sharpe_ratio",title:"Sharpe"},{id:"alpha",title:"Alpha"},{id:"beta",title:"Beta"},{id:"correlation",title:"Correlation"},];children=[{id:"1",title:"1 Year Rolling Annualised"},{id:"3",title:"3 Years Rolling Annualised"},{id:"5",title:"5 Years Rolling Annualised"},];items=[];for(T=0;T<parents.length;T++){childItems=[];if(parents[T].id=="ann_return"){childItems.push({id:"si",title:"Since Inception"})}for(x=0;x<children.length;x++){childItems.push({id:parents[T].id+children[x].id,title:children[x].title,layout:"fit",})}items.push({xtype:"tabpanel",title:parents[T].title,id:"w18-parent-"+parents[T].id,activeTab:0,items:childItems,listeners:{tabchange:function(ad,ac){U(ac.id)}}})}var V="tab-"+R.window.key+"-"+ab;$('<div id="'+V+'"></div>').appendTo("#"+ab);var Z=new Ext.TabPanel({renderTo:V,id:"w18-tabs",activeTab:0,items:items,layout:"fit",listeners:{beforetabchange:function(ad,ac){if(ac.id=="summary-tab"){v();return false}var ae=ac.id.split("-");U(ae[2])}}});U("si");Z.add({title:"Summary",id:"summary-tab",})}else{if(R.window.key=="w23"){this_year=new Date().getFullYear();parents=[];items=[];children=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(T=this_year;T>2002;T--){parents.push(T)}for(T=0;T<parents.length;T++){childItems=[];for(x=0;x<children.length;x++){childItems.push({id:parents[T]+"-"+(1+x),title:children[x],layout:{type:"vbox",align:"stretch"}})}items.push({xtype:"tabpanel",title:parents[T],id:"w23-parent-"+parents[T],activeTab:0,items:childItems,listeners:{tabchange:function(ad,ac){P(ac.id)}}})}var V="tab-"+R.window.key+"-"+ab;$('<div id="'+V+'"></div>').appendTo("#"+ab);var Z=new Ext.TabPanel({renderTo:V,id:"w23-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(ad,ac){var ae=ac.id.split("-");P(ae[2])}}});P(this_year+"-1");return d(R.window.id,X,R.window.name,R.window.size_x,R.window.size_y,R.id,ab)}}if(R.window.key=="w13"){this_year=new Date().getFullYear();parents=[];items=[];for(T=this_year;T>2002;T--){parents.push(T)}for(T=0;T<parents.length;T++){items.push({title:parents[T],id:"w13-year-"+parents[T],})}var V="tab-"+R.window.key+"-"+ab;$('<div id="'+V+'"></div>').appendTo("#"+ab);var Z=new Ext.TabPanel({renderTo:V,id:"w13-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(ad,ac){var ae=ac.id.split("-");aa(ac,ae[2])}}});tab=Ext.getCmp("w13-year-"+this_year);aa(tab,this_year);return d(R.window.id,X,R.window.name,R.window.size_x,R.window.size_y,R.id,ab)}$.ajax({type:"GET",url:"/api/widgets/?window="+R.window.id,ajaxI:T,success:function(af){I=this.ajaxI;var ag=R.window.layout+"box";var ad=[];for(x=0;x<af.length;x++){var ae="page_"+X+"_win_"+R.window.id+"_widget_"+af[x].id;$('<div id="'+ae+'"></div>').appendTo("#"+ab);var ac=K(Q,af[x],ae);ad[x]={contentEl:ae,height:(120*af[x].size_y)+(10*af[x].size_y)+(10*(af[x].size_y-1)),width:(120*af[x].size_x)+(10*af[x].size_x)+(10*(af[x].size_x-1)),border:false,}}Ext.create("Ext.container.Container",{renderTo:ab,autoFit:true,title:"asdf",header:true,layout:ag,items:ad,});d(R.window.id,X,R.window.name,R.window.size_x,R.window.size_y,R.id,ab)}})}function d(R,T,U,P,O,Q,S){Ext.create("Ext.window.Window",{title:U,height:(120*O)+(10*O)+(10*(O-1))-10,width:(120*P)+(10*P)+(10*(P-1))-10,layout:"auto",floatable:false,draggable:false,closable:false,contentEl:S,x:0,y:0,renderTo:T+"_"+R,tools:[{type:"close",handler:function(Y,X,W,V){Ext.Msg.show({title:"Remove Widget?",msg:"You want to remove the widget from this page?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.CONFIRM,fn:function(aa){if(aa=="ok"){var Z=$("#data").data("grid"+T);Z.remove_widget($("#"+T+"_"+R));H(Q)}}})}}],}).show()}function H(O){$.ajax({type:"DELETE",url:"/api/pagewindow/"+O+"/",success:function(){},error:function(P){},})}function K(R,Q,T,P){if(typeof R.fund=="undefined"){R.fund=$("#data").data("fund")}if(typeof P!="undefined"){$.each(P,function(U,V){Q.qs=Q.qs.replace(U.toUpperCase(),V)})}$.each(Q.params,function(U,V){Q.qs=Q.qs.replace(U.toUpperCase(),V)});if(typeof R.year=="undefined"||typeof R.month=="undefined"){R.year=new Date().getFullYear();R.month=new Date().getMonth()+1}Q.div=T;Q.url="/api/widget/"+Q.key+"/";$.each(R,function(U,V){Q.qs=Q.qs.replace(U.toUpperCase(),V)});if(Q.type=="month_table"){return z(R,Q,T)}else{if(Q.type=="data_table"){return A(R,Q,T)}else{if(Q.type=="data_table_sub"){return h(R,Q,T)}else{if(Q.type=="line_chart"){return l(R,Q,T)}else{if(Q.type=="chart_doubley"){D(R,Q,T)}else{if(Q.type=="bar_chart"){var S=new Date();S.setDate(1);S.setHours(-1);var O=R.year+"-"+R.month+"-"+S.getDate();Q.qs=Q.qs.replace("DATE",O);return o(R,Q,T)}else{if(Q.type=="line_bar_chart"){$("#data").data("linebar-div",T);$("#"+T).append("<p>Please select a Holding above</p>")}else{if(Q.type=="pie_chart"){return L(R,Q,T)}else{if(Q.type=="euro_percent_table"){return G(R,Q,T)}}}}}}}}}}function l(R,S,O){if(typeof $("#"+O).highcharts()!="undefined"){}if(typeof S.params.type=="undefined"){var V="line"}else{var V=S.params.type}var W=false;if(typeof S.params.title!="undefined"&&S.params.title=="true"){W=true}var Q=true;if(typeof S.params.yDecimals!="undefined"&&S.params.yDecimals==="false"){Q=false}var P="Performance";if(typeof S.params.yAxisTitle!="undefined"){if(S.params.yAxisTitle=="false"){P=false}else{P=S.params.yAxisTitle}}var T=true;if(typeof S.params.labels!="undefined"&&S.params.labels=="false"){T=false}var Y=true;if(typeof S.params.legend!="undefined"&&S.params.legend=="false"){Y=false}var Z=false;if(typeof S.params.scrollbar!="undefined"&&S.params.scrollbar=="true"){Z=true}var X=false;if(typeof S.params.navigator!="undefined"&&S.params.navigator=="true"){X=true}var U=true;if(typeof S.params.rangeSelector!="undefined"&&S.params.rangeSelector=="false"){U=false}$.getJSON(S.url+S.qs,function(ac){var aa={chart:{type:V,marginRight:25,size:"100%",renderTo:O,width:(120*S.size_x)+(10*S.size_x)+(10*(S.size_x-1))-10,height:(120*S.size_y)+(10*S.size_y)+(10*(S.size_y-1)),},navigator:{enabled:X,adaptToUpdatedData:false,series:ac,height:20,},scrollbar:{enabled:Z},rangeSelector:{enabled:U,selected:4},title:{enabled:W,text:S.name,},xAxis:{gridLineWidth:1,},yAxis:{title:{text:P,},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{},legend:{enabled:Y,},series:ac,};if(typeof S.params.date_type!="undefined"&&S.params.date_type=="month"){aa.rangeSelector={enabled:true,buttons:[{type:"year",count:1,text:"1y"},{type:"year",count:5,text:"5y"},{type:"year",count:10,text:"10y"},{type:"all",text:"All"}],inputEnabled:false,selected:1}}if(typeof S.params.zoom!="undefined"&&S.params.zoom=="true"){aa.xAxis={events:{afterSetExtremes:function(ad){zoomGraph(ad,S)}},minRange:3600*1000}}var ab=new Highcharts.StockChart(aa)})}function D(Q,P,R){if(typeof P.params.type=="undefined"){var O="line"}else{var O=P.params.type}$.getJSON(P.url+P.qs,function(T){var S=new Highcharts.StockChart({chart:{type:O,renderTo:R,width:(120*P.size_x)+(10*P.size_x)+(10*(P.size_x-1))-50,height:(120*P.size_y)+(10*P.size_y)+(10*(P.size_y-1))-100,},navigator:{enabled:true,},scrollbar:{enabled:false},rangeSelector:{},title:{text:false},yAxis:[{},{opposite:true}],series:T})})}function o(P,O,Q){$.getJSON(O.url+O.qs,function(S){title=false;if(typeof O.params.title!="undefined"&&O.params.title=="true"){title=O.name}type="column";if(typeof O.params.type!="undefined"){type=O.params.type}yDecimals=true;if(typeof O.params.yDecimals!="undefined"&&O.params.yDecimals==="false"){yDecimals=false}labels=true;if(typeof O.params.labels!="undefined"&&O.params.labels=="false"){labels=false}legend=true;if(typeof O.params.legend!="undefined"&&O.params.legend=="false"){legend=false}scrollbar=false;if(typeof O.params.scrollbar!="undefined"&&O.params.scrollbar=="true"){scrollbar=true}var R=new Highcharts.Chart({chart:{renderTo:Q,type:type,width:(120*O.size_x)+(10*O.size_x)+(10*(O.size_x-1))-30,height:(120*O.size_y)+(10*O.size_y)+(10*(O.size_y-1))-35,},title:{text:false},subtitle:{text:false},yAxis:{title:{text:false,},allowDecimals:yDecimals,},legend:{enabled:legend,},series:[{data:S,color:"white"}],exporting:{enabled:true},xAxis:{type:"category",categories:S.columns,labels:{rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"},enabled:labels,},},series:S.objects,});$("#data").data("div-"+O.key,Q)})}function z(P,O,Q){$.getJSON(O.url+O.qs,function(U){var W=new Date(P.year,P.month-1,1);var Y=W.getDay();var T=new Date(P.year,P.month,0);var X=T.getDate();var S='<table class="month_table"><tr>';if(Y<6){for(i=1;i<Y;i++){S+="<td></td>"}}days={};for(i=0;i<U.length;i++){var R=U[i].date.substr(8,2);R=parseInt(R,10);days[R]=U[i].value}for(i=1;i<=X;i++){if(typeof days[i]!="undefined"){var V=days[i]}else{var V=0}date=P.year.toString()+"-"+P.month.toString()+"-"+i;var W=new Date(date);if(W.getDay()==6||W.getDay()==0){if(W.getDay()==0&&i==1){continue}else{if(W.getDay()==6&&i==1){i++;continue}else{S+="</tr><tr>";i++;continue}}}S+="<td>"+i+'<a href="#" onclick="monthlyBar(\''+date+"', "+P.fund+');">'+V+"</a></td>"}S+="</tr></table>";Ext.create("Ext.container.Container",{id:"month-table",width:400,renderTo:Q,items:[{id:"month-table-content",xtype:"container",html:S,}]})})}function g(P,O,Q){fields=[];for(i=0;i<O.columns.length;i++){fields[i]=O.columns[i].dataIndex}Ext.create("Ext.data.Store",{storeId:P.key,fields:fields,data:O,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});return Ext.create("Ext.grid.Panel",{title:P.params.title,store:Ext.data.StoreManager.lookup(P.key),columns:O.columns,height:(120*P.size_y)+(10*P.size_y)+(10*(P.size_y-1))-20,width:(120*P.size_x)+(10*P.size_x)+(10*(P.size_x-1))-20,layout:{type:"vbox",align:"stretch"},listeners:{cellclick:function(W,V,T,R){year=obj.page=$("#data").data("year");month=T;if(month!=0){if(typeof year=="undefined"){year=new Date().getFullYear()}obj.page=$("#data").data("page_id");obj.grid=$("#data").data("grid"+obj.page);extra_params={year:year,};if(P.window.key=="w8"){group="sec"}else{if(P.window.key=="w9"){group="sub"}else{if(P.window.key=="w10"){group="loc"}}}Q=$("#data").data("piechart-div-"+P.window.key);var U="page_"+obj.page+"_win_"+P.window.id;P.key="fundperfgrouppie";P.qs="?fund=1&value_date__year=YEAR&value_date__month="+month+"&holding_category__holding_group="+group+"&fields=nav&value_date__day=1";P.params.value_date__year=year;P.params.holding_category__holding_group="sec";P.params.fund="FUND";P.params.fields="nav";P.type="pie_chart";var S=$("#"+Q).highcharts();S.destroy();K(obj,P,Q,extra_params)}}}})}function G(P,O,Q){$.getJSON(O.url+O.qs,function(T){if(typeof Ext.getCmp(Q)!="undefined"){U=Ext.getCmp(Q);U.destroy()}var U=Ext.create("Ext.tab.Panel",{renderTo:Q,id:Q,});O.params.title="â‚¬";var S=g(O,T);U.add(S);U.doLayout();var R=O.qs.replace("fields=nav","fields=weight");O.params.title="% of Fund";$.getJSON(O.url+R,function(W){var V=g(O,W);U.add(V);U.doLayout()})})}function a(S,R){var P=$("#data").data("fund");fields=[];c=0;for(i=0;i<S.columns.length;i++){if(typeof S.columns[i].columns!="undefined"){for(x=0;x<S.columns[i].columns.length;x++){fields[c]=S.columns[i].columns[x].dataIndex;c++}}else{if(typeof S.columns[i].dataIndex!="undefined"){fields[c]=S.columns[i].dataIndex;c++}}}fields.push("group");var O=Ext.create("Ext.data.Store",{storeId:"groupStore",fields:fields,groupField:"group",data:S,proxy:{type:"memory",reader:{type:"json",root:"rows"}}});var Q=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});return Ext.create("Ext.grid.Panel",{columnLines:true,store:Ext.data.StoreManager.lookup("groupStore"),columns:S.columns,features:[Q],width:(120*R.size_x)+(10*R.size_x)+(10*(R.size_x-1)),height:(120*R.size_y)+(10*R.size_y)+(10*(R.size_y-1)),})}function A(P,O,Q){if(typeof P.fund!="undefined"){$("#data").data("fund",P.fund)}$.getJSON(O.url+O.qs,function(R){c=0;for(i=0;i<R.columns.length;i++){if(typeof R.columns[i].columns!="undefined"){for(x=0;x<R.columns[i].columns.length;x++){fields[c]=R.columns[i].columns[x].dataIndex;c++}}else{if(typeof R.columns[i].dataIndex!="undefined"){fields[c]=R.columns[i].dataIndex;c++}}}Ext.create("Ext.data.Store",{storeId:O.key,fields:fields,data:R.rows,proxy:{type:"memory",reader:{type:"json",root:"rows"}},sortInfo:{direction:"DESC",field:"year"},});return Ext.create("Ext.grid.Panel",{id:Q,columnLines:true,store:Ext.data.StoreManager.lookup(O.key),columns:R.columns,width:(120*O.size_x)+(10*O.size_x)+(10*(O.size_x-1)),height:(120*O.size_y)+(10*O.size_y)+(10*(O.size_y-1)),header:false,border:false,enableLocking:true,autoScroll:true,renderTo:Q,layout:"fit",listeners:{cellclick:function(V,U,T,S){year=S.data.year;P.page=$("#data").data("page_id");P.grid=$("#data").data("grid"+P.page);extra_params={year:year,};month=T;if(O.window.key=="w1"){if(T==0){f("w3",P,extra_params);f("w4",P,extra_params);f("w5",P,extra_params)}else{if(T<13){monthlyBar(year+"-"+month+"-1",P.fund)}}}if(O.window.key=="w6"){if(T==0){$("#data").data("year",year);f("w8",P,extra_params);f("w9",P,extra_params);f("w10",P,extra_params)}else{if(T<13){monthlyBar(year+"-"+month+"-1",P.fund,"performance","weight")}}}}}})})}function f(P,Q,O){$.getJSON("/api/widgets/?window__key="+P,function(R){for(x=0;x<R.length;x++){var V="page_"+Q.page+"_win_"+R[x].window.id;var S=V+"_widget_"+R[x].id;if(R[x].type=="data_table"){var T=Ext.getCmp(S)}else{var T=$("#"+S).highcharts()}try{T.destroy()}catch(U){}$('<div id="'+S+'"></div>').appendTo("#"+V);K(Q,R[x],S,O)}})}function h(P,O,Q){$.getJSON(O.url+O.qs,function(R){fields=["id"];for(i=0;i<R.columns.length;i++){fields[i]=R.columns[i].dataIndex}var S=Ext.create("Ext.data.Store",{fields:fields,data:R.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var T=Ext.create("Ext.grid.Panel",{store:S,columns:R.columns,selModel:{selType:"cellmodel"},width:(140*O.size_x)+(10*O.size_x)+(10*(O.size_x-1)),height:(140*O.size_y)+(10*O.size_y)+(10*(O.size_y-1)),plugins:[{ptype:"rowexpander",rowBodyTpl:['<div id="innergrid{id}">',"</div>"]}],header:false,border:0,iconCls:"icon-grid",renderTo:Q,id:"subtable"+O.key,});T.view.on("expandBody",function(X,V,U,W){var Y=V.get("id");if(O.key=="fundperfholdtable"){$.getJSON("/api/widget/fundperfholdtradetable/?holding="+Y+"&holding__fund="+P.fund,function(Z){displayInnerGrid(Z,Y);O.holding=V.get("id");O.fund=P.fund;lineBarChart(O)})}else{if(O.key=="fundregister"){$.getJSON("/api/widget/subscriptionredemption/?&fund="+P.fund+"&client="+Y,function(Z){displayInnerGrid(Z,Y)})}}if(typeof $("#data").data("last-open-subgrid")!="undefined"){}});T.view.on("collapsebody",function(X,V,U,W){})})}function L(P,O,Q){$("#data").data("piechart-div-"+O.window.key,Q);if(O.key=="fundnavpie"){$("#data").data("linebar-div",Q);$("#"+Q).append("<p>Please click on a month</p>");return}$.getJSON(O.url+O.qs,function(S){var R=new Highcharts.Chart({chart:{renderTo:Q,marginTop:-50,marginLeft:30,marginRight:30,height:(120*2)+(10*2)+(10*(2-1)),width:(120*2)+(10*2)+(10*(2-1)),},title:{text:false},series:[{type:"pie",name:O.name,data:S}]})})}function r(O){setInterval(function(){try{var P=Ext.StoreMgr.lookup(O);P.reload()}catch(Q){}},2000)}function t(){var P=new Array();window.oldSetInterval=window.setInterval;window.setInterval=function(R,Q){P.push(oldSetInterval(R,Q))};for(var O in P){window.clearInterval(O)}}Ext.QuickTips.init();function s(){var O=$("#data").data("page_id");$.ajax({type:"GET",url:"/api/widget/unused/?page="+O,success:function(P){var Q=Ext.create("Ext.data.Store",{storeId:"widgets",fields:["name","widget_type"],groupField:"widget_type",autoLoad:true,proxy:{data:P,type:"memory",reader:{type:"json",}},});var S=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})'});var R=Ext.create("Ext.grid.Panel",{iconCls:"icon-grid",frame:true,store:Q,header:false,region:"west",width:"60%",bodyBorder:true,hideHeaders:true,features:[S],columns:[{text:"Widget",flex:1,dataIndex:"name",},{text:"Type",flex:1,dataIndex:"widget_type",hidden:true,}],listeners:{itemclick:function(W,U){$.ajax({type:"GET",url:"/api/widget/info/"+U.data.id,success:function(Y){$("#data").data("widget",Y);html='<div class="widget_desc"><img src="'+STATIC_URL+"widget-images/"+Y.key+'.png"></img><h1>'+Y.name+"</h1>"+Y.description+"</div>";var Z=Ext.getCmp("widget_desc");Z.update(html)},dataType:"json",contentType:"application/json",error:function(Y){}});try{var V=Ext.getCmp("add_widget_btn");V.enable()}catch(X){}}}});var T=Ext.create("Ext.window.Window",{title:"Layout Window",closable:true,title:"Add Widget",width:"50%",height:"50%",layout:"border",items:[R,{region:"center",autoScroll:true,id:"widget_desc",html:'<div class="widget_preview">&#60;Preview&#62;</div>',}],buttonAlign:"right",buttons:[{scope:this,text:"Cancel",iconCls:"icon-cancel",handler:function(){T.close()}},{scope:this,text:"Add",iconCls:"icon-ok",disabled:true,id:"add_widget_btn",handler:function(){data=$("#data").data("widget");page=$("#data").data("page_id");R={};R.widget=data.resource_uri;R.page="/api/page/"+page+"/";R.row=1;R.col=1;R.size_y=data.size_y;R.size_x=data.size_x;$.ajax({type:"POST",url:"/api/pagewindow/",data:JSON.stringify(R),dataType:"json",contentType:"application/json",success:function(V){var W='<div id="'+page+"_"+data.key+'" pagewindow="'+V.id+'" class="layout_block"></div>';var U=$("#data").data("grid"+page);U.add_widget(W,data.size_x,data.size_y,1,1);K(data,page);d(data.key,page,data.name,data.size_x,data.size_y);T.close()},})}}],}).show()},error:function(P){}})}function j(O){var O=$.parseJSON(O);for(i=0;i<O.length;i++){data={col:O[i].col,row:O[i].row,};$.ajax({type:"PATCH",url:"/api/pagewindow/"+O[i].pagewindow+"/",data:JSON.stringify(data),dataType:"json",contentType:"application/json",error:function(P){},})}}function e(){return Ext.create("Ext.panel.Panel",{region:"center",id:"panel-home",contentEl:"menu",autoDestroy:true,autoScroll:true,defaults:{autoScroll:true},})}function b(){return Ext.create("Ext.tab.Panel",{region:"center",contentEl:"menu",id:"panel-tab",autoDestroy:true,autoScroll:true,layout:"fit"})}var p=new Ext.menu.Menu({items:[{text:"Resize Widget",id:"resize_widget",},{text:"Remove Widget",id:"remove_widget",}],defaults:{listeners:{click:function(P,O){if(P.id=="resize_widget"){}else{if(P.id=="remove_widget"){}}}}},});var q=Ext.create("Ext.menu.Menu",{items:[{text:"Change Theme",menu:{items:[{text:"Default",checked:true,group:"theme",id:"theme_default",checkHandler:k},{text:"BlueBay",checked:false,group:"theme",id:"theme_bluebay",checkHandler:k}]}},{text:"Re-order Panels",id:"enable_drag",},{text:"Lock Panels",id:"disable_drag",hidden:true,},{text:"Log out",id:"log_out",}],defaults:{listeners:{click:function(P,O){page=$("#data").data("page_id");if(P.id=="add_widget"){s()}else{if(P.id=="disable_drag"){$("#data").data("grid"+page).disable();Ext.getCmp("enable_drag").setVisible(true);Ext.getCmp("disable_drag").setVisible(false)}else{if(P.id=="enable_drag"){$("#data").data("grid"+page).enable();Ext.getCmp("disable_drag").setVisible(true);Ext.getCmp("enable_drag").setVisible(false)}else{if(P.id=="log_out"){n()}}}}}}},});function k(P,O){if(P.id==="theme_bluebay"){var Q="extjs-themes/bluebay/css/bluebay.css"}else{if(P.id==="theme_default"){var Q="extjs/resources/css/ext-all.css"}}Ext.util.CSS.swapStyleSheet("theme",STATIC_URL+Q)}function B(O){$.ajax({type:"GET",url:"/api/"+O,success:function(P){$("#data").data(O,P)}})}function w(){$.ajax({type:"GET",url:"/api/menu/",success:function(R){var T=Ext.define("tree",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"text",type:"string",mapping:"name"},{name:"page",type:"string"},]});var Q=Ext.create("Ext.data.TreeStore",{model:T,proxy:{data:R,type:"memory",reader:{type:"json",}},});var P=Ext.create("Ext.tree.Panel",{id:"main-menu",store:Q,rootVisible:false,preventHeader:true,border:false,autoScroll:true,useArrows:true,height:1000,listeners:{itemexpand:{fn:function(U,V){nodeId=U.data.id}},itemclick:{fn:function(V,U,Z,W,Y,X){if(U.isExpanded()){U.collapse()}else{U.expand()}$("#data").data("fund",U.raw.fund);if(U.raw.page!==null){if(typeof U.raw.page==="object"){U.raw.page=U.raw.page.id}else{var aa=U.raw.page.toString();U.raw.page=aa.replace(/\D/g,"")}}M(U.raw)}}}});var S=Ext.create("Ext.panel.Panel",{id:"west",region:"west",collapsible:true,title:"Navigation",width:150,items:[P],tools:[{type:"gear",handler:function(X,W,V,U){q.showBy(W,"tr-br?")}}],});var O=Ext.create("Ext.container.Viewport",{layout:"border",id:"viewport",items:[S,e()]});Ext.EventManager.onWindowResize(O.doLayout,O)}})}Ext.QuickTips.init();var y=new Ext.FormPanel({labelWidth:80,url:"/api/user/login/",frame:true,defaultType:"textfield",monitorValid:true,header:false,style:"padding:10px",headers:{"Content-Type":"application/json"},items:[{fieldLabel:"Username",name:"username",allowBlank:false},{fieldLabel:"Password",name:"password",inputType:"password",allowBlank:false}],buttons:[{text:"Login",formBind:true,handler:function(){y.getForm().submit({method:"POST",headers:{"Content-Type":"application/json","X-HTTP-Method-Override":"POST"},success:function(){E.close();B("fund");B("page");w();page=new Object();page.page=1;u(page)},failure:function(O,P){Ext.Msg.alert("Login failed!","Wrong user name or passsword");y.getForm().reset()}})}}],});var E=new Ext.Window({closeAction:"hide",id:"login-window",title:"Please Login",layout:"fit",width:300,height:150,closable:false,resizable:false,plain:true,border:false,items:[y]});$("#data").data("login-window",E);function n(){$.ajax({type:"GET",url:"/api/user/logout/",success:function(O){var P=$("#data").data("active-panel");Ext.getCmp("west").setVisible(false);Ext.getCmp(P).setVisible(false);$("#data").data("login-window").show()},failure:function(){Ext.Msg.alert("Logout failed!","You could not be logged out.")}})}function N(O){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(O))}$.ajaxSetup({crossDomain:false,beforeSend:function(P,O){if(!N(O.type)){P.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))}}});$.ajax({type:"GET",url:"/api/loggedin/",success:function(O){B("page");$('<div id="menu" class="gridster"></div>').appendTo("body");w();$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");page=new Object();page.page=1;u(page)},error:function(){$('<div id="menu" class="gridster"></div>').appendTo("body");$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");E.show()}})});
