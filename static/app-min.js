Ext.Loader.setPath("Ext.ux","static/extjs/examples/ux");Ext.require(["Ext.ux.RowExpander"]);Ext.require(["Ext.container.Viewport","Ext.layout.container.Border","Ext.tab.Panel","Ext.tree.*","Ext.data.*","Ext.menu.*","Ext.window.MessageBox","Ext.grid.*",]);function displayInnerGrid(b,d){fields=[];for(i=0;i<b.columns.length;i++){fields[i]=b.columns[i].dataIndex}var e=Ext.create("Ext.data.Store",{fields:fields,data:b.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var a=Ext.create("Ext.grid.Panel",{store:e,selModel:{selType:"cellmodel"},columns:b.columns,header:false,width:1000,height:150,iconCls:"icon-grid",renderTo:"innergrid"+d,});a.getEl().swallowEvent(["mousedown","mouseup","click","contextmenu","mouseover","mouseout","dblclick","mousemove"])}function zoomGraph(k,h){var m=h.qs.replace("&value_date__month=2,4,6,8,10,12","");var b=new Date(k.min);var g=new Date(k.max);var j=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();var d=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var f="&value_date__gte="+j+"&value_date__lte="+d;range=(k.max/1000)-(k.min/1000);range=Math.round(range);var a="";if(range>300000000){a="&value_date__month=2,4,6,8,10,12"}else{if(range>=240000000){}else{if(range>=120000000){}else{if(range>=60000000){}else{var a=""}}}}var l=$("#"+h.div).highcharts();l.showLoading("Loading data from server...");$.getJSON(h.url+m+f+a,function(e){l.series[0].setData(e[0].data);l.hideLoading()})}function zoomLineBarGraph(k){console.log(k);holding=$("#data").data("holding");var a=$("#data").data("linebar-div");var m="?holding_category__holding_group__isnull=true&holding="+holding;var d=new Date(k.min);var h=new Date(k.max);var j=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();var f=h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate();var g="&value_date__gte="+j+"&value_date__lte="+f;range=(k.max/1000)-(k.min/1000);range=Math.round(range);if(range>31557600){var b="&value_date__month=2,4,6,8,10,12&value_date__day=1"}else{if(range>=31535000){var b="&value_date__week_day=4"}else{if(range>=15535000){var b="&value_date__week_day=3,5"}else{if(range>=7700000){var b="&value_date__week_day=2,4,6"}else{var b=""}}}}var l=$("#"+a).highcharts();l.showLoading("Loading data from server...");$.getJSON("/api/widget/fundperfholdpriceline/"+m+g+b,function(e){l.series[0].setData(e);l.hideLoading();$.getJSON("/api/widget/fundperfholdvolbar/"+m+g+b,function(n){l.series[1].setData(n);l.hideLoading()})})}function lineBarChart(b){b.url="/api/widget/fundperfholdpriceline/";b.qs="?holding_category__holding_group__isnull=true&value_date__month=2,4,6,8,10,12&value_date__day=1&holding__fund="+b.fund+"&holding="+b.holding;$("#data").data("holding",b.holding);var d=$("#data").data("linebar-div");var a=$("#"+d).highcharts();if(typeof a!="undefined"){a.destroy()}$.getJSON(b.url+b.qs,function(e){b.url="/api/widget/fundperfholdvolbar/";$.getJSON(b.url+b.qs,function(h){var f={chart:{renderTo:d,marginTop:5,marginRight:50,},navigator:{enabled:true,adaptToUpdatedData:false,series:{data:e}},scrollbar:{enabled:false,},title:{text:false,},xAxis:[{gridLineWidth:1,type:"datetime",labels:{rotation:-45,align:"right",style:{fontSize:"13px",fontFamily:"Verdana, sans-serif"}},events:{afterSetExtremes:zoomLineBarGraph},minRange:3600*1000},{}],yAxis:[{height:180,lineWidth:3,offset:0,gridLineWidth:1,title:{text:"Price",margin:5,}},{top:225,lineWidth:3,gridLineWidth:1,offset:0,height:75,title:{text:"Volume",}},],legend:{enabled:true,verticalAlign:"top",y:-10,},rangeSelector:{enabled:true,buttons:[{type:"month",count:1,text:"1m"},{type:"month",count:3,text:"3m"},{type:"month",count:6,text:"6m"},{type:"year",count:1,text:"1y"},{type:"all",text:"All"}],inputEnabled:false,selected:4},series:[{yAxis:0,name:"Price by time",stack:0,data:e,tooltip:{valueDecimals:2},},{name:"Volume by time",yAxis:1,stack:0,data:h,tooltip:{valueDecimals:2},lineWidth:3,marker:{enabled:false},pointWidth:5,type:"column",},]};var g=new Highcharts.Chart(f)})})}function destroyInnerGrid(a){var b=document.getElementById("innergrid"+a.get("id"));var d=b.firstChild;while(d){d.parentNode.removeChild(d);d=d.nextSibling}}function refreshHoldPerfBar(f,e,d,j,h){if(typeof j=="undefined"){j="nav"}if(typeof h=="undefined"){h="weight"}var b=$("#data").data("div-fundperfholdperfbar");win_div=b.slice(0,b.indexOf("_widget"));var m=f;if(typeof d!="undefined"&&d==true){m=moment(f).format("MMM YYYY")}var l=$("#data").data("fund_name")+" / "+m+" / Holding Performance Bar Graph";win=Ext.getCmp(win_div);win.setTitle(l);var k=$("#"+b).highcharts();var a="/api/widget/fundperfholdperfbar/?value_date="+f+"&fund="+e+"&legend=false&fields="+j+"&order_by="+h+"&holding_category__isnull=true";try{k.destroy();$.getJSON(a,function(o){widget={};widget.size_x=5;widget.size_y=3;var n=new Highcharts.Chart({chart:{renderTo:b,type:"column",width:(120*widget.size_x)+(10*widget.size_x)+(10*(widget.size_x-1))-30,height:(120*widget.size_y)+(10*widget.size_y)+(10*(widget.size_y-1))-35,},title:{text:false,},legend:{enabled:false,},xAxis:{type:"category",categories:o.columns,labels:{rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"},enabled:labels,},},series:o.objects,})})}catch(g){}}Ext.onReady(function(){function v(){graphs={1:[{ann_return1:"Returns one ann"},{ann_volatility1:"Volatility one ann"},{alpha1:"Alpha one ann"},{beta1:"Beta one ann"},{sharpe_ratio1:"Sharpe one ann"},{correlation1:"Correlation one ann"},],2:[{ann_return3:"Returns three ann"},{ann_volatility3:"Volatility three ann"},{alpha3:"Alpha three ann"},{beta3:"Beta three ann"},{sharpe_ratio3:"Sharpe three ann"},{correlation3:"Correlation three ann"},],3:[{ann_return5:"Returns five ann"},{ann_volatility5:"Volatility five ann"},{alpha5:"Alpha five ann"},{beta5:"Beta five ann"},{sharpe_ratio5:"Sharpe five ann"},{correlation5:"Correlation five ann"},]};var Q=$("#data").data("fund");items=[];for(var T in graphs){children=[];for(var P in graphs[T]){key=Object.keys(graphs[T][P])[0];var S="summary2-bar-"+key;var R="summary2-line-"+key;$('<div id="'+S+'"></div>').appendTo("body");$('<div id="'+R+'"></div>').appendTo("body");win_widget={};win_widget.url="/api/widget/fundperfmonthmin/";win_widget.qs="?fund="+Q+"&fields="+key+"&value_date__month=2,4,6,8,10,12";win_widget.size_y=1.9;win_widget.size_x=3;win_widget.div=S;win_widget.params={};win_widget.params.type="column";win_widget.params.legend="false";win_widget.params.scrollbar="false";win_widget.params.navigator="true";win_widget.params.zoom="true";win_widget.params.rangeSelector="true";win_widget.params.title="false";win_widget.params.yAxisTitle=graphs[T][P][key];win_widget.params.date_type="month";l("",win_widget,S);children.push({xtype:"tabpanel",border:1,width:(120*win_widget.size_x)+(10*win_widget.size_x)+(10*(win_widget.size_x-1))-20,height:(120*win_widget.size_y)+(10*win_widget.size_y)+(10*(win_widget.size_y-1))+20,items:[{xtype:"panel",title:"Bar",contentEl:S,id:S},{xtype:"panel",title:"Line",contentEl:R,id:R}],listeners:{tabchange:function(V,U){win_widget.params.type="line";l("",win_widget,U.id)}}})}parent={xtype:"container",layout:"hbox",items:children,};items.push(parent)}Ext.onReady(function(){var U=new Ext.Window({renderTo:Ext.getBody(),items:items,listeners:{close:function(W,V){$.each(graphs,function(X,Y){$.each(Y,function(Z,aa){Z=Object.keys(aa)[0];F("summary2-bar-"+Z);F("summary2-line-"+Z)})})}}});U.toggleMaximize();U.show()})}function F(Q){if(typeof $("#"+Q).highcharts()!="undefined"){var P=$("#"+Q).highcharts();P.destroy()}}$('<div id="data"></div>').appendTo("body");function M(R){var S=R.page;var P=$("#data").data("page");for(i=0;i<P.length;i++){if(P[i].id==S){el="page"+S;if(P[i].children!==undefined){var Q=b();C(Q,el);m(P[i]);R.page=P[i].children[0].id}else{var Q=e();C(Q,el);$("#data").data("grid"+S,"");$('<div id="page'+S+'"></div>').appendTo("#menu")}u(R)}}}function m(Q){var P=Ext.getCmp("panel-tab");P.removeAll();for(x=0;x<Q.children.length;x++){id=Q.children[x].id;$('<div id="page'+id+'" class="gridster"></div>').appendTo("body");$("#data").data("grid"+id,"");P.add({title:Q.children[x].title,id:id,contentEl:"page"+id,autoScroll:true,listeners:{activate:function(R){obj={};obj.page=R.id;u(obj)}},})}P.setActiveTab(0)}function C(Q,R){var T=$("#data").data("active-panel");var P=Ext.getCmp("viewport");try{P.remove(T)}catch(S){}$('<div id="menu" class="gridster"></div>').appendTo("body");try{P.add(Q)}catch(S){}P.doLayout();$("#data").data("active-panel",Q.id)}function u(Q){var P=Q.page;$("#data").data("page_id",P);if($("#data").data("grid"+P)!==undefined&&$("#data").data("grid"+P)!==""){return}Q.grid=$("#page"+P).gridster({widget_margins:[10,10],widget_base_dimensions:[120,120],max_size_x:10,max_size_y:10,draggable:{stop:function(R,S){j(JSON.stringify(Q.grid.serialize()))}},serialize_params:function(S,R){return{id:R.el[0].id,col:R.col,row:R.row,size_y:R.size_y,size_x:R.size_x,pagewindow:S.context.attributes.pagewindow.value,}}}).data("gridster");Q.grid.disable();$("#data").data("grid"+P,Q.grid);$.ajax({type:"GET",url:"/api/pagewindow/?page="+P,success:function(R){$("#data").data("grid_data"+P,R);for(i=0;i<R.length;i++){J(R[i],i,Q)}}})}function J(S,U,R,T){if(typeof R.fund=="undefined"){R.fund=$("#data").data("fund")}function Z(ae,af,ad){if(typeof Ext.getCmp("grid"+ae)=="undefined"){fields=[];for(U=0;U<af.columns.length;U++){fields[U]=af.columns[U].dataIndex}Ext.create("Ext.data.Store",{storeId:"store"+ae,fields:fields,data:af,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});return Ext.create("Ext.grid.Panel",{store:Ext.data.StoreManager.lookup("store"+ae),columns:af.columns,id:"grid"+ae,border:false,flex:ad,})}}function Q(ae){var ad=ae.split("-");if(typeof ad[1]=="undefined"){ad[1]=1;ad[0]=ae;ae=ae+"-1"}$.getJSON("/api/widget/fundsubredtable/?fund="+R.fund+"&year="+ad[0]+"&month="+ad[1]+"&column_width=80,80",function(af){tab=Ext.getCmp(ae);var ag=Z(ae,af,0);tab.add(ag);$.getJSON("/api/widget/subscriptionredemptionmonth/?fund="+R.fund+"&year="+ad[0]+"&month="+ad[1]+"&column_width=100,100",function(ai){tab=Ext.getCmp(ae);var ah=Z("client"+ae,ai,1);tab.add(ah)})})}function ab(ae,ad){$.getJSON("/api/widget/fundgrossasset/?fund="+R.fund+"&year="+ad+"&column_width=160,85",function(ag){var af=a(ag,S.window);ae.insert(0,af);ae.doLayout()})}function V(ad){fund=$("#data").data("fund");var ae=ad.toString().slice(-1);if($.isNumeric(ae)==false){if(ad=="ann_return"){ad="si"}else{if(ad!="si"){ad=ad+"1"}}}if(typeof Ext.getCmp("grid"+ad)=="undefined"){tab=Ext.getCmp(ad);$.getJSON("/api/widget/fundperfmonth/?fund="+fund+"&fields="+ad+"&column_width=55,60",function(aj){var ai=Z(ad,aj);tab.add(ai);var af="inner-tab"+ad;$('<div id="'+af+'-bar"></div>').appendTo("#"+W);$('<div id="'+af+'-line"></div>').appendTo("#"+W);widget={};widget.url="";widget.qs="/api/widget/fundperfbenchcompline/?fields="+ad+"&fund="+fund;widget.size_y=3;widget.size_x=6;widget.params={};widget.params.title="";widget.params.date_type="month";widget.params.navigator="true";widget.params.rangeSelector="true";var ag=$("#"+af+"-bar").highcharts();if(typeof ag=="undefined"){widget.params.type="column";l("",widget,af+"-bar")}var ah=new Ext.TabPanel({id:"inner-tab-id"+ad,height:600,activeTab:0,items:[{title:"Bar Chart",id:"bar"+ad,contentEl:af+"-bar",},{title:"Line Graph",id:"line"+ad,contentEl:af+"-line",}],listeners:{tabchange:function(am,al){if(al.id=="line"+ad){div2=af+"-line";var ak=$("#"+div2).highcharts();if(typeof ak=="undefined"){widget.params.type="line";l("",widget,div2)}}}}});tab.add(ah)})}}var Y=R.page;var P=$("#data").data("grid"+Y);var X='<div id="'+Y+"_"+S.window.id+'" pagewindow="'+S.id+'" class="layout_block"></div>';P.add_widget(X,S.window.size_x,S.window.size_y,S.col,S.row);var ac="page_"+Y+"_"+S.window.id;$('<div id="'+ac+'"></div>').appendTo("body");if(S.window.key=="w15"){$.getJSON("/api/widget/fundsummary/"+R.fund,function(ad){d(S.window.id,Y,S.window.name,S.window.size_x,S.window.size_y,S.id,ac);html='<div> <table width="100%" class="html_table"><tr><td>Fund Name</td><td>'+ad.name+"</td></tr><tr><td>Fund Type</td><td>"+ad.fund_type.name+"</td></tr><tr><td>Fund Manager</td><td>"+ad.manager.first_name+ad.manager.last_name+"</td></tr><tr><td> Description</td><td>"+ad.description+"<d></tr><tr><td>Custodian</td><td>"+ad.custodian.name+"</td><td>"+ad.custodian.contact_name+"</td><td>"+ad.custodian.contact_number+"</td><td>Managment Fee</td><td>"+ad.management_fee+"</td><td>Performance Fee</td><td>"+ad.performance_fee+"</td></tr><tr><td>Administrator</td><td>"+ad.administrator.name+"</td><td>"+ad.administrator.contact_name+"</td><td>"+ad.administrator.contact_number+"</td><td>Administrator Fee</td><td>"+ad.administrator.fee+"</td></tr><tr><td>Auditor</td><td>"+ad.auditor.name+"</td><td>"+ad.auditor.contact_name+"</td><td>"+ad.auditor.contact_number+"</td><td>Auditor Fee</td><td>"+ad.auditor.fee+"</td></tr><tr><td>Subscription Terms</td><td>"+ad.subscription_frequency+"</td></tr><tr><td>Redemption Terms</td><td>"+ad.redemption_frequency+"</td></tr><tr><td>Management Fees</td><td>"+ad.management_fee+"</td></tr><tr><td>Performance Fees</td><td>"+ad.performance_fee+"</td></tr><tr><td>Benchmark</td><td>"+ad.benchmark.name+"</td></tr></table> </div>";$(html).appendTo("#"+ac)});return}if(S.window.key=="w18"){parents=[{id:"ann_return",title:"Returns"},{id:"ann_volatility",title:"Volatility"},{id:"sharpe_ratio",title:"Sharpe"},{id:"alpha",title:"Alpha"},{id:"beta",title:"Beta"},{id:"correlation",title:"Correlation"},];children=[{id:"1",title:"1 Year Rolling Annualised"},{id:"3",title:"3 Years Rolling Annualised"},{id:"5",title:"5 Years Rolling Annualised"},];items=[];for(U=0;U<parents.length;U++){childItems=[];if(parents[U].id=="ann_return"){childItems.push({id:"si",title:"Since Inception"})}for(x=0;x<children.length;x++){childItems.push({id:parents[U].id+children[x].id,title:children[x].title,layout:"fit",})}items.push({xtype:"tabpanel",title:parents[U].title,id:"w18-parent-"+parents[U].id,activeTab:0,items:childItems,listeners:{tabchange:function(ae,ad){V(ad.id)}}})}var W="tab-"+S.window.key+"-"+ac;$('<div id="'+W+'"></div>').appendTo("#"+ac);var aa=new Ext.TabPanel({renderTo:W,id:"w18-tabs",activeTab:0,items:items,layout:"fit",listeners:{beforetabchange:function(ae,ad){if(ad.id=="summary-tab"){v();return false}var af=ad.id.split("-");V(af[2])}}});V("si");aa.add({title:"Summary",id:"summary-tab",});return d(S.window.id,Y,S.window.name,S.window.size_x,S.window.size_y,S.id,ac)}else{if(S.window.key=="w23"){this_year=new Date().getFullYear();parents=[];items=[];children=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(U=this_year;U>2002;U--){parents.push(U)}for(U=0;U<parents.length;U++){childItems=[];for(x=0;x<children.length;x++){childItems.push({id:parents[U]+"-"+(1+x),title:children[x],layout:{type:"vbox",align:"stretch"}})}items.push({xtype:"tabpanel",title:parents[U],id:"w23-parent-"+parents[U],activeTab:0,items:childItems,listeners:{tabchange:function(ae,ad){Q(ad.id)}}})}var W="tab-"+S.window.key+"-"+ac;$('<div id="'+W+'"></div>').appendTo("#"+ac);var aa=new Ext.TabPanel({renderTo:W,id:"w23-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(ae,ad){var af=ad.id.split("-");Q(af[2])}}});Q(this_year+"-1");return d(S.window.id,Y,S.window.name,S.window.size_x,S.window.size_y,S.id,ac)}}if(S.window.key=="w13"){this_year=new Date().getFullYear();parents=[];items=[];for(U=this_year;U>2002;U--){parents.push(U)}for(U=0;U<parents.length;U++){items.push({title:parents[U],id:"w13-year-"+parents[U],})}var W="tab-"+S.window.key+"-"+ac;$('<div id="'+W+'"></div>').appendTo("#"+ac);var aa=new Ext.TabPanel({renderTo:W,id:"w13-tabs",activeTab:0,items:items,layout:"fit",listeners:{tabchange:function(ae,ad){var af=ad.id.split("-");ab(ad,af[2])}}});tab=Ext.getCmp("w13-year-"+this_year);ab(tab,this_year);return d(S.window.id,Y,S.window.name,S.window.size_x,S.window.size_y,S.id,ac)}$.ajax({type:"GET",url:"/api/widgets/?window="+S.window.id,ajaxI:U,success:function(ag){I=this.ajaxI;var ah=S.window.layout+"box";var ae=[];for(x=0;x<ag.length;x++){var af="page_"+Y+"_win_"+S.window.id+"_widget_"+ag[x].id;$('<div id="'+af+'"></div>').appendTo("#"+ac);var ad=K(R,ag[x],af);ae[x]={contentEl:af,height:(120*ag[x].size_y)+(10*ag[x].size_y)+(10*(ag[x].size_y-1)),width:(120*ag[x].size_x)+(10*ag[x].size_x)+(10*(ag[x].size_x-1)),border:false,}}Ext.create("Ext.container.Container",{renderTo:ac,autoFit:true,title:"asdf",header:true,layout:ah,items:ae,});d(S.window.id,Y,S.window.name,S.window.size_x,S.window.size_y,S.id,ac)}})}function d(S,U,V,Q,P,R,T){if(typeof $("#data").data("fund_name")!="undefined"){V=V.replace("FUND_NAME",$("#data").data("fund_name"));V=V.replace("DATE",moment().format("YYYY"))}Ext.create("Ext.window.Window",{title:V,height:(120*P)+(10*P)+(10*(P-1))-10,width:(120*Q)+(10*Q)+(10*(Q-1))-10,layout:"auto",floatable:false,draggable:false,closable:false,contentEl:T,x:0,y:0,renderTo:U+"_"+S,id:"page_"+U+"_win_"+S,tools:[{type:"close",handler:function(Z,Y,X,W){Ext.Msg.show({title:"Remove Widget?",msg:"You want to remove the widget from this page?",buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.CONFIRM,fn:function(ab){if(ab=="ok"){var aa=$("#data").data("grid"+U);aa.remove_widget($("#"+U+"_"+S));H(R)}}})}}],}).show()}function H(P){$.ajax({type:"DELETE",url:"/api/pagewindow/"+P+"/",success:function(){},error:function(Q){},})}function K(S,R,U,Q){if(typeof S.fund=="undefined"){S.fund=$("#data").data("fund")}if(typeof Q!="undefined"){$.each(Q,function(V,W){R.qs=R.qs.replace(V.toUpperCase(),W)})}$.each(R.params,function(V,W){R.qs=R.qs.replace(V.toUpperCase(),W)});if(typeof S.year=="undefined"||typeof S.month=="undefined"){S.year=new Date().getFullYear();S.month=new Date().getMonth()+1}R.div=U;R.url="/api/widget/"+R.key+"/";$.each(S,function(V,W){R.qs=R.qs.replace(V.toUpperCase(),W)});if(R.type=="data_table"){return A(S,R,U)}else{if(R.type=="data_table_sub"){return h(S,R,U)}else{if(R.type=="line_chart"){return l(S,R,U)}else{if(R.type=="chart_doubley"){D(S,R,U)}else{if(R.type=="bar_chart"){var T=new Date();T.setDate(1);T.setHours(-1);var P=S.year+"-"+S.month+"-"+T.getDate();R.qs=R.qs.replace("DATE",P);return o(S,R,U)}else{if(R.type=="line_bar_chart"){$("#data").data("linebar-div",U);$("#"+U).append("<p>Please select a Holding above</p>")}else{if(R.type=="pie_chart"){return L(S,R,U)}else{if(R.type=="euro_percent_table"){return G(S,R,U)}}}}}}}}}function l(S,T,P){if(typeof $("#"+P).highcharts()!="undefined"){}if(typeof T.params.type=="undefined"){var W="line"}else{var W=T.params.type}var X=false;if(typeof T.params.title!="undefined"&&T.params.title=="true"){X=true}var R=true;if(typeof T.params.yDecimals!="undefined"&&T.params.yDecimals==="false"){R=false}var Q="Performance";if(typeof T.params.yAxisTitle!="undefined"){if(T.params.yAxisTitle=="false"){Q=false}else{Q=T.params.yAxisTitle}}var U=true;if(typeof T.params.labels!="undefined"&&T.params.labels=="false"){U=false}var Z=true;if(typeof T.params.legend!="undefined"&&T.params.legend=="false"){Z=false}var aa=false;if(typeof T.params.scrollbar!="undefined"&&T.params.scrollbar=="true"){aa=true}var Y=false;if(typeof T.params.navigator!="undefined"&&T.params.navigator=="true"){Y=true}var V=true;if(typeof T.params.rangeSelector!="undefined"&&T.params.rangeSelector=="false"){V=false}$.getJSON(T.url+T.qs,function(ad){var ab={chart:{type:W,marginRight:25,size:"100%",renderTo:P,width:(120*T.size_x)+(10*T.size_x)+(10*(T.size_x-1))-10,height:(120*T.size_y)+(10*T.size_y)+(10*(T.size_y-1)),},navigator:{enabled:Y,adaptToUpdatedData:false,series:ad,height:20,},scrollbar:{enabled:aa},rangeSelector:{enabled:V,selected:4},title:{enabled:X,text:T.name,},xAxis:{gridLineWidth:1,},yAxis:{title:{text:Q,},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{},legend:{enabled:Z,},series:ad,};if(typeof T.params.date_type!="undefined"&&T.params.date_type=="month"){ab.rangeSelector={enabled:true,buttons:[{type:"year",count:1,text:"1y"},{type:"year",count:5,text:"5y"},{type:"year",count:10,text:"10y"},{type:"all",text:"All"}],inputEnabled:false,selected:1}}if(typeof T.params.zoom!="undefined"&&T.params.zoom=="true"){ab.xAxis={events:{afterSetExtremes:function(ae){zoomGraph(ae,T)}},minRange:3600*1000}}var ac=new Highcharts.StockChart(ab)})}function D(R,Q,S){if(typeof Q.params.type=="undefined"){var P="line"}else{var P=Q.params.type}$.getJSON(Q.url+Q.qs,function(U){var T=new Highcharts.StockChart({chart:{type:P,renderTo:S,width:(120*Q.size_x)+(10*Q.size_x)+(10*(Q.size_x-1))-50,height:(120*Q.size_y)+(10*Q.size_y)+(10*(Q.size_y-1))-100,},navigator:{enabled:true,},scrollbar:{enabled:false},rangeSelector:{},title:{text:false},yAxis:[{},{opposite:true}],series:U})})}function o(Q,P,R){$.getJSON(P.url+P.qs,function(T){title=false;if(typeof P.params.title!="undefined"&&P.params.title=="true"){title=P.name}type="column";if(typeof P.params.type!="undefined"){type=P.params.type}yDecimals=true;if(typeof P.params.yDecimals!="undefined"&&P.params.yDecimals==="false"){yDecimals=false}labels=true;if(typeof P.params.labels!="undefined"&&P.params.labels=="false"){labels=false}legend=true;if(typeof P.params.legend!="undefined"&&P.params.legend=="false"){legend=false}scrollbar=false;if(typeof P.params.scrollbar!="undefined"&&P.params.scrollbar=="true"){scrollbar=true}var S=new Highcharts.Chart({chart:{renderTo:R,type:type,width:(120*P.size_x)+(10*P.size_x)+(10*(P.size_x-1))-30,height:(120*P.size_y)+(10*P.size_y)+(10*(P.size_y-1))-35,},title:{text:false},subtitle:{text:false},yAxis:{title:{text:false,},allowDecimals:yDecimals,},legend:{enabled:legend,},series:[{data:T,color:"white"}],exporting:{enabled:true},xAxis:{type:"category",categories:T.columns,labels:{rotation:-45,align:"right",style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"},enabled:labels,},},series:T.objects,});$("#data").data("div-"+P.key,R)})}function z(Q,R){var P=$("#data").data("fund");$('<div id="calendar"></div>').appendTo("body");mo_widget={};mo_widget.url="/api/widget/fundperfhistcalview/";mo_widget.qs="?fund="+P+"&order_by=weight&value_date__year="+Q+"&value_date__month="+R;$.getJSON(mo_widget.url+mo_widget.qs,function(V){var Z=new Date(Q,R-1,1);var T=Z.getDay();var S=new Date(Q,R,0);var W=S.getDate();var X='<table class="month_table"><tr>';if(T<6){for(i=1;i<T;i++){X+="<td></td>"}}days={};for(i=0;i<V.length;i++){var aa=V[i].date.substr(8,2);aa=parseInt(aa,10);days[aa]=V[i].value}for(i=1;i<=W;i++){if(typeof days[i]!="undefined"){var U=days[i]}else{var U=0}date=Q.toString()+"-"+R.toString()+"-"+i;var Z=new Date(date);if(Z.getDay()==6||Z.getDay()==0){if(Z.getDay()==0&&i==1){continue}else{if(Z.getDay()==6&&i==1){i++;continue}else{X+="</tr><tr>";i++;continue}}}X+="<td>"+i+'<a href="#" onclick="refreshHoldPerfBar(\''+date+"', "+P+');">'+U+"</a></td>"}X+="</tr></table>";var Y=new Ext.Window({renderTo:Ext.getBody(),html:X,height:300,width:400,});Y.show();return;Ext.create("Ext.container.Container",{id:"month-table",width:400,renderTo:div,items:[{id:"month-table-content",xtype:"container",html:X,}]})})}function g(Q,P,R){fields=[];for(i=0;i<P.columns.length;i++){fields[i]=P.columns[i].dataIndex}Ext.create("Ext.data.Store",{storeId:Q.key,fields:fields,data:P,proxy:{type:"memory",reader:{type:"json",root:"rows"}},});return Ext.create("Ext.grid.Panel",{title:Q.params.title,store:Ext.data.StoreManager.lookup(Q.key),columns:P.columns,height:(120*Q.size_y)+(10*Q.size_y)+(10*(Q.size_y-1))-20,width:(120*Q.size_x)+(10*Q.size_x)+(10*(Q.size_x-1))-20,layout:{type:"vbox",align:"stretch"},listeners:{cellclick:function(X,W,U,S){year=obj.page=$("#data").data("year");month=U;if(month!=0){if(typeof year=="undefined"){year=new Date().getFullYear()}obj.page=$("#data").data("page_id");obj.grid=$("#data").data("grid"+obj.page);extra_params={year:year,};if(Q.window.key=="w8"){group="sec"}else{if(Q.window.key=="w9"){group="sub"}else{if(Q.window.key=="w10"){group="loc"}}}R=$("#data").data("piechart-div-"+Q.window.key);var V="page_"+obj.page+"_win_"+Q.window.id;Q.key="fundperfgrouppie";Q.qs="?fund=1&value_date__year=YEAR&value_date__month="+month+"&holding_category__holding_group="+group+"&fields=nav&value_date__day=1";Q.params.value_date__year=year;Q.params.holding_category__holding_group="sec";Q.params.fund="FUND";Q.params.fields="nav";Q.type="pie_chart";var T=$("#"+R).highcharts();T.destroy();K(obj,Q,R,extra_params)}}}})}function G(Q,P,R){$.getJSON(P.url+P.qs,function(U){if(typeof Ext.getCmp(R)!="undefined"){V=Ext.getCmp(R);V.destroy()}var V=Ext.create("Ext.tab.Panel",{renderTo:R,id:R,});P.params.title="€";var T=g(P,U);V.add(T);V.doLayout();var S=P.qs.replace("fields=nav","fields=weight");P.params.title="% of Fund";$.getJSON(P.url+S,function(X){var W=g(P,X);V.add(W);V.doLayout()})})}function a(T,S){var Q=$("#data").data("fund");fields=[];c=0;for(i=0;i<T.columns.length;i++){if(typeof T.columns[i].columns!="undefined"){for(x=0;x<T.columns[i].columns.length;x++){fields[c]=T.columns[i].columns[x].dataIndex;c++}}else{if(typeof T.columns[i].dataIndex!="undefined"){fields[c]=T.columns[i].dataIndex;c++}}}fields.push("group");var P=Ext.create("Ext.data.Store",{storeId:"groupStore",fields:fields,groupField:"group",data:T,proxy:{type:"memory",reader:{type:"json",root:"rows"}}});var R=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}"});return Ext.create("Ext.grid.Panel",{columnLines:true,store:Ext.data.StoreManager.lookup("groupStore"),columns:T.columns,features:[R],width:(120*S.size_x)+(10*S.size_x)+(10*(S.size_x-1)),height:(120*S.size_y)+(10*S.size_y)+(10*(S.size_y-1)),})}function A(Q,P,R){$.getJSON(P.url+P.qs,function(T){c=0;for(i=0;i<T.columns.length;i++){if(typeof T.columns[i].columns!="undefined"){for(x=0;x<T.columns[i].columns.length;x++){fields[c]=T.columns[i].columns[x].dataIndex;c++}}else{if(typeof T.columns[i].dataIndex!="undefined"){fields[c]=T.columns[i].dataIndex;c++}}}Ext.create("Ext.data.Store",{storeId:P.key,fields:fields,data:T.rows,proxy:{type:"memory",reader:{type:"json",root:"rows"}},sortInfo:{direction:"DESC",field:"year"},});var S=Ext.create("Ext.grid.Panel",{id:R,cls:"custom-grid",columnLines:true,store:Ext.data.StoreManager.lookup(P.key),columns:T.columns,width:(120*P.size_x)+(10*P.size_x)+(10*(P.size_x-1)),height:(120*P.size_y)+(10*P.size_y)+(10*(P.size_y-1)),header:false,border:false,enableLocking:true,autoScroll:true,renderTo:R,listeners:{cellclick:function(X,W,V,U){year=U.data.year;Q.page=$("#data").data("page_id");Q.grid=$("#data").data("grid"+Q.page);extra_params={year:year,};month=V;if(P.window.key=="w1"){if(V==0){f("w3",Q,extra_params);f("w4",Q,extra_params);f("w5",Q,extra_params)}else{if(V<13){refreshHoldPerfBar(year+"-"+month+"-1",Q.fund,true);z(year,month)}}}if(P.window.key=="w6"){if(V==0){$("#data").data("year",year);f("w8",Q,extra_params);f("w9",Q,extra_params);f("w10",Q,extra_params)}else{if(V<13){refreshHoldPerfBar(year+"-"+month+"-1",Q.fund,true,"performance","weight")}}}}}});return S})}function f(Q,R,P){$.getJSON("/api/widgets/?window__key="+Q,function(S){for(x=0;x<S.length;x++){var W="page_"+R.page+"_win_"+S[x].window.id;var T=W+"_widget_"+S[x].id;var X=S[x].window.name;if(P.year!="undefined"){date=P.year}else{date="Week X"}X=X.replace("FUND_NAME",$("#data").data("fund_name"));X=X.replace("DATE",date);E=Ext.getCmp(W);E.setTitle(X);if(S[x].type=="data_table"){var U=Ext.getCmp(T)}else{var U=$("#"+T).highcharts()}try{U.destroy()}catch(V){}$('<div id="'+T+'"></div>').appendTo("#"+W);K(R,S[x],T,P)}})}function h(Q,P,R){$.getJSON(P.url+P.qs,function(S){fields=["id"];for(i=0;i<S.columns.length;i++){fields[i]=S.columns[i].dataIndex}var T=Ext.create("Ext.data.Store",{fields:fields,data:S.rows,proxy:{type:"memory",reader:{type:"json",root:"objects"}}});var U=Ext.create("Ext.grid.Panel",{store:T,columns:S.columns,selModel:{selType:"cellmodel"},width:(140*P.size_x)+(10*P.size_x)+(10*(P.size_x-1)),height:(140*P.size_y)+(10*P.size_y)+(10*(P.size_y-1)),plugins:[{ptype:"rowexpander",rowBodyTpl:['<div id="innergrid{id}">',"</div>"]}],header:false,border:0,iconCls:"icon-grid",renderTo:R,id:"subtable"+P.key,});U.view.on("expandBody",function(Y,W,V,X){var Z=W.get("id");if(P.key=="fundperfholdtable"){$.getJSON("/api/widget/fundperfholdtradetable/?holding="+Z+"&holding__fund="+Q.fund+"&column_width=80,80",function(aa){displayInnerGrid(aa,Z);P.holding=W.get("id");P.fund=Q.fund;lineBarChart(P)})}else{if(P.key=="fundregister"){$.getJSON("/api/widget/subscriptionredemption/?&fund="+Q.fund+"&client="+Z+"&column_width=100,100",function(aa){displayInnerGrid(aa,Z)})}}if(typeof $("#data").data("last-open-subgrid")!="undefined"){}});U.view.on("collapsebody",function(Y,W,V,X){})})}function L(Q,P,R){$("#data").data("piechart-div-"+P.window.key,R);if(P.key=="fundnavpie"){$("#data").data("linebar-div",R);$("#"+R).append("<p>Please click on a month</p>");return}$.getJSON(P.url+P.qs,function(T){var S=new Highcharts.Chart({chart:{renderTo:R,marginTop:-50,marginLeft:30,marginRight:30,height:(120*2)+(10*2)+(10*(2-1)),width:(120*2)+(10*2)+(10*(2-1)),},title:{text:false},series:[{type:"pie",name:P.name,data:T}]})})}function r(P){setInterval(function(){try{var Q=Ext.StoreMgr.lookup(P);Q.reload()}catch(R){}},2000)}function t(){var Q=new Array();window.oldSetInterval=window.setInterval;window.setInterval=function(S,R){Q.push(oldSetInterval(S,R))};for(var P in Q){window.clearInterval(P)}}Ext.QuickTips.init();function s(){var P=$("#data").data("page_id");$.ajax({type:"GET",url:"/api/widget/unused/?page="+P,success:function(Q){var R=Ext.create("Ext.data.Store",{storeId:"widgets",fields:["name","widget_type"],groupField:"widget_type",autoLoad:true,proxy:{data:Q,type:"memory",reader:{type:"json",}},});var T=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})'});var S=Ext.create("Ext.grid.Panel",{iconCls:"icon-grid",frame:true,store:R,header:false,region:"west",width:"60%",bodyBorder:true,hideHeaders:true,features:[T],columns:[{text:"Widget",flex:1,dataIndex:"name",},{text:"Type",flex:1,dataIndex:"widget_type",hidden:true,}],listeners:{itemclick:function(X,V){$.ajax({type:"GET",url:"/api/widget/info/"+V.data.id,success:function(Z){$("#data").data("widget",Z);html='<div class="widget_desc"><img src="'+STATIC_URL+"widget-images/"+Z.key+'.png"></img><h1>'+Z.name+"</h1>"+Z.description+"</div>";var aa=Ext.getCmp("widget_desc");aa.update(html)},dataType:"json",contentType:"application/json",error:function(Z){}});try{var W=Ext.getCmp("add_widget_btn");W.enable()}catch(Y){}}}});var U=Ext.create("Ext.window.Window",{title:"Layout Window",closable:true,title:"Add Widget",width:"50%",height:"50%",layout:"border",items:[S,{region:"center",autoScroll:true,id:"widget_desc",html:'<div class="widget_preview">&#60;Preview&#62;</div>',}],buttonAlign:"right",buttons:[{scope:this,text:"Cancel",iconCls:"icon-cancel",handler:function(){U.close()}},{scope:this,text:"Add",iconCls:"icon-ok",disabled:true,id:"add_widget_btn",handler:function(){data=$("#data").data("widget");page=$("#data").data("page_id");S={};S.widget=data.resource_uri;S.page="/api/page/"+page+"/";S.row=1;S.col=1;S.size_y=data.size_y;S.size_x=data.size_x;$.ajax({type:"POST",url:"/api/pagewindow/",data:JSON.stringify(S),dataType:"json",contentType:"application/json",success:function(W){var X='<div id="'+page+"_"+data.key+'" pagewindow="'+W.id+'" class="layout_block"></div>';var V=$("#data").data("grid"+page);V.add_widget(X,data.size_x,data.size_y,1,1);K(data,page);d(data.key,page,data.name,data.size_x,data.size_y);U.close()},})}}],}).show()},error:function(Q){}})}function j(P){var P=$.parseJSON(P);for(i=0;i<P.length;i++){data={col:P[i].col,row:P[i].row,};$.ajax({type:"PATCH",url:"/api/pagewindow/"+P[i].pagewindow+"/",data:JSON.stringify(data),dataType:"json",contentType:"application/json",error:function(Q){},})}}function e(){return Ext.create("Ext.panel.Panel",{region:"center",id:"panel-home",contentEl:"menu",autoDestroy:true,autoScroll:true,defaults:{autoScroll:true},})}function b(){return Ext.create("Ext.tab.Panel",{region:"center",contentEl:"menu",id:"panel-tab",autoDestroy:true,autoScroll:true,layout:"fit"})}var p=new Ext.menu.Menu({items:[{text:"Resize Widget",id:"resize_widget",},{text:"Remove Widget",id:"remove_widget",}],defaults:{listeners:{click:function(Q,P){if(Q.id=="resize_widget"){}else{if(Q.id=="remove_widget"){}}}}},});var q=Ext.create("Ext.menu.Menu",{items:[{text:"Change Theme",menu:{items:[{text:"Default",checked:true,group:"theme",id:"theme_default",checkHandler:k},{text:"BlueBay",checked:false,group:"theme",id:"theme_bluebay",checkHandler:k}]}},{text:"Re-order Panels",id:"enable_drag",},{text:"Lock Panels",id:"disable_drag",hidden:true,},{text:"Log out",id:"log_out",}],defaults:{listeners:{click:function(Q,P){page=$("#data").data("page_id");if(Q.id=="add_widget"){s()}else{if(Q.id=="disable_drag"){$("#data").data("grid"+page).disable();Ext.getCmp("enable_drag").setVisible(true);Ext.getCmp("disable_drag").setVisible(false)}else{if(Q.id=="enable_drag"){$("#data").data("grid"+page).enable();Ext.getCmp("disable_drag").setVisible(true);Ext.getCmp("enable_drag").setVisible(false)}else{if(Q.id=="log_out"){n()}}}}}}},});function k(Q,P){if(Q.id==="theme_bluebay"){var R="extjs-themes/bluebay/css/bluebay.css"}else{if(Q.id==="theme_default"){var R="extjs/resources/css/ext-all.css"}}Ext.util.CSS.swapStyleSheet("theme",STATIC_URL+R)}function B(P){$.ajax({type:"GET",url:"/api/"+P,success:function(Q){$("#data").data(P,Q)}})}function N(P){$.ajax({type:"GET",url:"/api/fund/"+P,success:function(Q){$("#data").data("fund_name",Q.name)}})}function w(){$.ajax({type:"GET",url:"/api/menu/",success:function(S){var U=Ext.define("tree",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"text",type:"string",mapping:"name"},{name:"page",type:"string"},]});var R=Ext.create("Ext.data.TreeStore",{model:U,proxy:{data:S,type:"memory",reader:{type:"json",}},});var Q=Ext.create("Ext.tree.Panel",{id:"main-menu",store:R,rootVisible:false,preventHeader:true,border:false,autoScroll:true,useArrows:true,height:1000,listeners:{itemexpand:{fn:function(V,W){nodeId=V.data.id}},itemclick:{fn:function(W,V,aa,X,Z,Y){if(V.isExpanded()){V.collapse()}else{V.expand()}if(typeof V.raw.fund!="undefined"){$("#data").data("fund",V.raw.fund);N(V.raw.fund)}if(V.raw.page!==null){if(typeof V.raw.page==="object"){V.raw.page=V.raw.page.id}else{var ab=V.raw.page.toString();V.raw.page=ab.replace(/\D/g,"")}}M(V.raw)}}}});var T=Ext.create("Ext.panel.Panel",{id:"west",region:"west",collapsible:true,title:"Navigation",width:150,items:[Q],tools:[{type:"gear",handler:function(Y,X,W,V){q.showBy(X,"tr-br?")}}],});var P=Ext.create("Ext.container.Viewport",{layout:"border",id:"viewport",items:[T,e()]});Ext.EventManager.onWindowResize(P.doLayout,P)}})}Ext.QuickTips.init();var y=new Ext.FormPanel({labelWidth:80,url:"/api/user/login/",frame:true,defaultType:"textfield",monitorValid:true,header:false,style:"padding:10px",headers:{"Content-Type":"application/json"},items:[{fieldLabel:"Username",name:"username",allowBlank:false},{fieldLabel:"Password",name:"password",inputType:"password",allowBlank:false}],buttons:[{text:"Login",formBind:true,handler:function(){y.getForm().submit({method:"POST",headers:{"Content-Type":"application/json","X-HTTP-Method-Override":"POST"},success:function(){E.close();B("fund");B("page");w();page=new Object();page.page=1;u(page)},failure:function(P,Q){Ext.Msg.alert("Login failed!","Wrong user name or passsword");y.getForm().reset()}})}}],});var E=new Ext.Window({closeAction:"hide",id:"login-window",title:"Please Login",layout:"fit",width:300,height:150,closable:false,resizable:false,plain:true,border:false,items:[y]});$("#data").data("login-window",E);function n(){$.ajax({type:"GET",url:"/api/user/logout/",success:function(P){var Q=$("#data").data("active-panel");Ext.getCmp("west").setVisible(false);Ext.getCmp(Q).setVisible(false);$("#data").data("login-window").show()},failure:function(){Ext.Msg.alert("Logout failed!","You could not be logged out.")}})}function O(P){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(P))}$.ajaxSetup({crossDomain:false,beforeSend:function(Q,P){if(!O(P.type)){Q.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))}}});$.ajax({type:"GET",url:"/api/loggedin/",success:function(P){B("page");$('<div id="menu" class="gridster"></div>').appendTo("body");w();$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");page=new Object();page.page=1;u(page)},error:function(){$('<div id="menu" class="gridster"></div>').appendTo("body");$('<div id="page1"></div>').appendTo("#menu");$("#data").data("active-panel","panel-home");E.show()}})});